# datai-pay-common 模块说明文档

## 模块概述

datai-pay-common 是 datai 支付场景的核心基础模块，提供支付系统的通用实体定义、数据访问层和业务逻辑抽象。该模块定义了支付订单和发票的核心数据模型，以及支付服务的统一接口，为各种支付方式实现提供了基础支撑。

## 核心功能

### 支付订单管理
- 定义完整的支付订单数据模型，包含订单基本信息、金额、状态等关键字段
- 提供订单的增删改查功能，支持按订单ID和订单号查询
- 实现订单状态管理，支持订单状态更新和流转
- 记录支付相关信息，包括支付方式、支付时间、支付人等

### 发票管理
- 定义发票数据模型，包含发票类型、抬头、纳税人识别号等信息
- 提供发票的增删改查功能，支持发票全生命周期管理
- 支持发票与订单的关联，实现订单开票功能

### 支付服务抽象
- 定义统一的支付服务接口，规范支付流程
- 提供支付URL生成、回调处理、订单查询和退款等核心功能
- 支持多种支付方式的统一接入，便于扩展新的支付渠道

## 主要作用

### 数据模型标准化
- 定义支付领域核心实体，统一数据结构和字段定义
- 提供标准化的数据访问接口，确保数据操作的一致性
- 支持数据持久化，通过MyBatis实现数据库操作

### 业务逻辑抽象
- 提供支付服务的通用接口，隐藏具体支付实现的复杂性
- 定义标准的支付流程，包括下单、支付、回调、查询和退款
- 支持支付方式的扩展，便于集成新的支付渠道

### 基础服务支撑
- 为上层支付实现提供基础数据访问能力
- 提供异常处理和错误码定义，增强系统健壮性
- 支持多条件查询和分页，满足业务查询需求

## 关键特性

### 完整的实体模型
- PayOrder实体：包含订单ID、订单号、第三方订单号、订单状态、金额、支付信息等完整字段
- PayInvoice实体：包含发票ID、订单号、发票类型、抬头、纳税人识别号、联系方式等发票信息
- 继承BaseEntity，自动支持创建时间、更新时间等审计字段

### 灵活的数据访问
- 基于MyBatis的数据访问层，支持复杂查询条件
- 提供XML映射文件，便于SQL优化和定制
- 支持批量操作，提高数据处理效率

### 统一的支付接口
- PayService接口定义支付核心方法：payUrl、notify、query、refund
- 支持支付回调处理，兼容不同支付渠道的通知机制
- 提供订单查询和退款功能，满足完整的支付业务需求

### 异常处理机制
- 自定义ServiceException，提供业务异常处理能力
- 订单不存在等业务场景的异常处理，增强系统健壮性
- 完善的错误信息提示，便于问题定位和解决

## 技术栈

- 核心框架：Spring Boot
- 持久层框架：MyBatis
- 数据库：MySQL（通过mapper.xml配置）
- 文档注解：Swagger/OpenAPI 3
- 工具库：Apache Commons Lang

## 依赖关系

datai-pay-common 作为基础模块，主要依赖：
- datai-common：提供通用工具类和基础功能

该模块被其他支付相关模块依赖，是整个支付场景的核心基础组件。