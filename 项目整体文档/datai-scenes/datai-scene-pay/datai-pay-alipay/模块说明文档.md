# datai-pay-alipay 模块说明文档

## 模块概述

datai-pay-alipay 是 datai 支付场景中的支付宝支付实现模块，提供与支付宝支付平台的完整集成能力。该模块基于支付宝官方 SDK，实现了支付宝支付的核心功能，包括支付下单、异步通知处理、订单查询和退款等，为应用系统提供稳定可靠的支付宝支付接入能力。

## 核心功能

### 支付宝支付集成
- 实现支付宝支付接口，支持生成支付链接或二维码
- 提供统一的支付接口实现，兼容支付宝支付流程
- 支持多种支付场景，包括网页支付、手机网站支付等

### 异步通知处理
- 处理支付宝支付结果异步通知，确保订单状态及时更新
- 实现通知验签机制，保证通知来源的真实性和数据完整性
- 支持自定义回调处理逻辑，满足业务需求

### 订单管理
- 提供订单查询功能，支持通过支付宝订单号或商户订单号查询
- 实现退款功能，支持全额或部分退款操作
- 维护本地订单与支付宝订单的映射关系

## 主要作用

### 支付宝SDK封装
- 封装支付宝官方 SDK，简化接入复杂度
- 提供统一的配置管理，支持多种配置方式
- 隐藏底层实现细节，提供简洁的API接口

### 支付流程标准化
- 遵循支付宝支付规范，确保支付流程合规
- 实现标准的支付状态流转，保证业务逻辑一致性
- 提供统一的异常处理机制，增强系统健壮性

### 安全保障
- 实现完整的签名验证机制，防止支付数据被篡改
- 支持证书模式，提高支付安全性
- 提供安全的密钥管理方案，避免密钥泄露风险

## 关键特性

### 灵活的配置管理
- 支持多种配置方式，包括直接字符串配置和文件路径配置
- 提供完整的配置元数据，便于IDE自动提示和配置校验
- 支持条件化配置，可根据环境动态启用或禁用支付宝支付

### 安全的密钥处理
- 强制使用UTF-8编码读取密钥文件，确保验签一致性
- 支持从classpath加载密钥文件，提高密钥管理的灵活性
- 提供密钥文件路径配置，支持绝对路径和相对路径

### 多环境支持
- 支持沙箱和生产环境切换，便于开发和测试
- 提供可配置的网关地址和协议类型
- 支持自定义签名类型，兼容不同的安全要求

### 完善的回调机制
- 实现支付宝异步通知处理，确保支付结果及时同步
- 提供回调参数解析，简化业务处理逻辑
- 支持自定义回调处理，满足特殊业务需求

## 技术栈

- 核心框架：Spring Boot
- 支付宝SDK：alipay-easysdk 2.2.0
- 配置管理：Spring Boot Configuration
- 文档注解：Spring Boot Configuration Metadata

## 依赖关系

datai-pay-alipay 模块主要依赖：
- datai-pay-common：提供支付基础接口和数据模型
- alipay-easysdk：支付宝官方SDK，提供支付宝API访问能力

## 配置说明

模块支持以下关键配置：
- pay.alipay.enabled：是否启用支付宝支付
- pay.alipay.appId：支付宝应用ID
- pay.alipay.appPrivateKey：应用私钥
- pay.alipay.alipayPublicKey：支付宝公钥
- pay.alipay.notifyUrl：支付回调地址

通过Spring Boot Configuration Metadata提供配置提示，提高开发体验。