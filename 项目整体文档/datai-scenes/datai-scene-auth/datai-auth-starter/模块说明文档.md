# datai-auth-starter 模块说明文档

## 模块概述

datai-auth-starter 是 datai-scene-auth 认证场景模块的启动器组件，作为整个认证体系的统一入口和集成点。该模块聚合了所有认证相关的子模块，提供统一的RESTful API接口，支持多种认证方式和双因素认证流程。

## 核心功能

### 1. 第三方认证管理
提供完整的第三方认证用户信息管理功能，包括：
- OAuth用户信息的查询、新增、修改和删除操作
- OAuth用户列表的分页展示和导出功能
- 基于权限控制的访问管理，确保只有授权用户才能操作

### 2. 双因素认证(TFA)统一接口
提供统一的双因素认证RESTful接口，支持多种认证渠道：
- 注册流程的双因素认证（发送验证码和验证）
- 登录流程的双因素认证（发送验证码和验证）
- 绑定流程的双因素认证（发送验证码和验证）
- 重置流程的双因素认证（发送验证码和验证）

### 3. 多渠道认证支持
通过动态服务发现机制，支持多种认证渠道：
- 邮箱认证渠道
- 手机短信认证渠道
- 第三方OAuth认证渠道
- 微信小程序和公众号认证渠道

## 主要作用

1. **统一认证入口**：为前端应用提供统一的认证API接口，简化客户端调用逻辑

2. **多认证方式集成**：整合多种认证方式，提供一致的接口规范和响应格式

3. **服务路由与分发**：根据请求参数动态路由到相应的认证服务实现

4. **权限控制**：集成Spring Security权限控制，确保认证操作的安全性

## 关键特性

1. **动态服务发现**：通过Spring的依赖注入机制，动态发现和加载可用的认证服务实现

2. **RESTful API设计**：采用标准的RESTful API设计，提供清晰、易用的接口

3. **Swagger文档支持**：集成OpenAPI 3.0规范，自动生成API文档，便于接口理解和使用

4. **权限细粒度控制**：基于Spring Security的细粒度权限控制，确保操作安全

5. **统一异常处理**：继承BaseController，获得统一的异常处理和响应格式

6. **日志记录**：集成操作日志记录，便于审计和问题排查

## 技术依赖

- datai-auth-common：提供认证相关的公共接口和数据模型
- datai-oauth-justauth：提供JustAuth第三方认证实现
- datai-oauth-wx：提供微信小程序和公众号认证实现
- datai-tfa-phone：提供手机短信双因素认证实现
- datai-tfa-email：提供邮箱双因素认证实现

## 使用场景

datai-auth-starter 主要服务于以下场景：
- 第三方OAuth认证的用户信息管理
- 多渠道双因素认证流程的统一处理
- 认证服务的动态路由和分发
- 认证操作的权限控制和日志记录

该模块作为认证体系的统一入口，不直接实现具体的认证逻辑，而是通过依赖注入调用各个具体认证模块的服务实现。这种设计使得系统具有良好的扩展性，新增认证方式时只需实现相应接口并注册为Spring Bean即可。

## 接口设计

### OAuth用户管理接口
- GET /system/oauth/list：查询OAuth用户列表
- GET /system/oauth/{id}：获取OAuth用户详情
- POST /system/oauth：新增OAuth用户
- PUT /system/oauth：修改OAuth用户
- DELETE /system/oauth/{ids}：删除OAuth用户
- POST /system/oauth/export：导出OAuth用户数据

### 双因素认证接口
- POST /auth/{channel}/send/register：发送注册验证码
- POST /auth/{channel}/verify/register：验证注册验证码
- POST /auth/{channel}/send/login：发送登录验证码
- POST /auth/{channel}/verify/login：验证登录验证码
- POST /auth/{channel}/send/bind：发送绑定验证码
- POST /auth/{channel}/verify/bind：验证绑定验证码
- POST /auth/{channel}/send/reset：发送重置验证码
- POST /auth/{channel}/verify/reset：验证重置验证码

其中{channel}参数支持：mail（邮箱）、dySms（短信）等认证渠道。