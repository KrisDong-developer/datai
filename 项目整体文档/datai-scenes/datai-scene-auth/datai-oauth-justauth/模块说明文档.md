# datai-oauth-justauth 模块说明文档

## 模块概述

datai-oauth-justauth 是基于 JustAuth 框架实现的第三方 OAuth 认证模块，为系统提供丰富的第三方平台登录能力。该模块集成了 JustAuth 开源组件，支持多达20余种主流第三方平台的OAuth认证，包括GitHub、Gitee、微信、QQ、支付宝等，为用户提供便捷的第三方登录体验。

## 核心功能

### 1. 多平台OAuth认证支持
支持主流第三方平台的OAuth认证，包括：
- 开发者平台：GitHub、Gitee、GitLab、Coding
- 社交平台：微信开放平台、微信小程序、QQ、微博、抖音、头条
- 企业平台：钉钉、企业微信、飞书、Teambition
- 电商平台：淘宝、支付宝、美团、饿了么
- 其他平台：百度、华为、小米、微软、LinkedIn、Pinterest等

### 2. OAuth认证流程管理
提供完整的OAuth认证流程处理：
- 授权请求生成和重定向
- 授权回调处理和用户信息获取
- 访问Seesion管理和刷新
- 用户状态缓存和管理

### 3. 用户绑定与解绑
支持第三方账号与系统用户的绑定和解绑：
- 已登录用户绑定第三方账号
- 第三方登录后绑定系统账号
- 用户自主解绑第三方账号

### 4. 配置管理
提供灵活的配置管理机制：
- 支持多平台配置动态加载
- 平台启用/禁用控制
- 安全参数配置（客户端ID、密钥、回调地址等）

## 主要作用

1. **扩展登录方式**：为系统提供多种第三方登录方式，提升用户体验和注册转化率

2. **降低注册门槛**：用户无需记住额外账号密码，通过熟悉的第三方平台即可快速登录

3. **统一认证体验**：通过统一的接口和流程，为不同第三方平台提供一致的认证体验

4. **安全性保障**：采用标准的OAuth2.0协议，确保认证过程的安全性和可靠性

## 关键特性

1. **平台丰富性**：支持20余种主流第三方平台，覆盖各类用户群体

2. **配置灵活性**：通过配置文件动态管理各平台参数，支持按需启用特定平台

3. **状态管理**：集成AuthStateCache，有效管理OAuth状态，防止CSRF攻击

4. **错误处理**：完善的异常处理机制，提供友好的错误提示

5. **扩展性**：基于JustAuth框架，易于扩展新的第三方平台支持

6. **安全性**：遵循OAuth2.0标准，使用安全的状态Seesion和回调验证

## 技术依赖

- datai-auth-common：提供认证相关的公共接口和数据模型
- JustAuth：开源的Java第三方登录组件，提供丰富的OAuth平台支持
- alipay-sdk-java：支付宝SDK，支持支付宝平台的OAuth认证

## 使用场景

datai-oauth-justauth 主要服务于以下场景：
- 用户通过第三方平台快速注册和登录
- 已有用户绑定第三方账号，便于后续快速登录
- 管理员查看和管理用户的第三方账号绑定情况
- 根据业务需求选择性启用特定第三方平台

## 接口设计

### 第三方登录接口
- GET /system/auth/login/{source}：获取第三方平台授权URL
- GET /system/auth/social-login/{source}：处理第三方平台回调，完成登录

### 账号绑定接口
- GET /system/auth/binding/{source}：获取第三方平台绑定授权URL

### 账号管理接口
- DELETE /system/auth/unlock/{authId}：解绑第三方账号

其中{source}参数支持：github、gitee、qq、wechat_open、wechat_mp、dingtalk、alipay等平台标识。

## 配置说明

模块通过justauth配置项管理各平台参数，支持以下配置：
```yaml
justauth:
  sources:
    github:
      client-id: [GitHub客户端ID]
      client-secret: [GitHub客户端密钥]
      redirect-uri: [回调地址]
    gitee:
      client-id: [Gitee客户端ID]
      client-secret: [Gitee客户端密钥]
      redirect-uri: [回调地址]
    # 其他平台配置...
```

通过这种配置方式，系统管理员可以灵活地管理各第三方平台的认证参数，根据业务需求启用或禁用特定平台。