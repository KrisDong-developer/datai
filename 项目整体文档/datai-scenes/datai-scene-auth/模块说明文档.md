# datai-scene-auth 模块说明文档

## 模块概述

datai-scene-auth 是 datai 项目中的认证场景模块，提供全面的身份认证和授权解决方案。该模块集成了多种认证方式，包括传统用户名密码认证、第三方OAuth认证、微信生态认证以及双因素认证(TFA)等，为系统提供灵活、安全、可扩展的身份认证能力。

## 模块结构

datai-scene-auth 由以下子模块组成：

### datai-auth-common
- **功能定位**: 认证通用模块，提供认证系统的基础功能和公共组件
- **核心能力**: 
  - OAuth用户实体定义和数据访问
  - 验证码服务和双因素认证接口定义
  - 随机码生成工具类
  - 认证相关枚举和常量定义

### datai-auth-starter
- **功能定位**: 认证启动器模块，提供认证相关的REST API接口
- **核心能力**:
  - 双因素认证控制器
  - OAuth用户管理控制器
  - 统一的认证入口和响应处理

### datai-oauth-justauth
- **功能定位**: 第三方OAuth认证模块，基于JustAuth框架实现
- **核心能力**:
  - 多平台第三方登录支持
  - OAuth认证流程管理
  - 第三方用户信息绑定和同步

### datai-oauth-wx
- **功能定位**: 微信生态认证模块，支持微信小程序和公众号登录
- **核心能力**:
  - 微信小程序登录认证
  - 微信公众号授权登录
  - 微信用户信息处理和绑定

### datai-tfa-email
- **功能定位**: 邮箱双因素认证模块，提供基于邮箱验证码的认证功能
- **核心能力**:
  - 邮箱验证码发送和验证
  - 基于邮箱的用户注册和登录
  - 邮箱绑定和解绑功能

### datai-tfa-phone
- **功能定位**: 手机号双因素认证模块，提供基于短信验证码的认证功能
- **核心能力**:
  - 短信验证码发送和验证
  - 基于手机号的用户注册和登录
  - 手机号绑定和解绑功能
  - 集成阿里云短信服务

## 技术架构

### 架构设计原则
- **模块化设计**: 各认证方式独立实现，便于维护和扩展
- **接口标准化**: 统一的认证接口规范，确保一致性
- **配置灵活**: 支持多种认证方式的灵活配置和组合使用
- **安全优先**: 多层次安全验证机制，保障系统安全

### 核心技术栈
- **Spring Boot**: 提供基础框架和依赖注入
- **Spring Security**: 提供安全认证和授权框架
- **MyBatis**: 提供数据持久化能力
- **JustAuth**: 提供第三方OAuth认证支持
- **阿里云短信服务**: 提供短信发送能力
- **Spring Mail**: 提供邮件发送能力

### 数据模型
- **OAuth用户**: 存储第三方认证用户信息
- **验证码**: 存储各类验证码信息
- **系统用户**: 与认证方式关联的用户主体信息

## 认证流程

### 传统认证流程
1. 用户提交用户名密码
2. 系统验证用户凭据
3. 生成访问Seesion和刷新Seesion
4. 返回认证结果

### 第三方OAuth认证流程
1. 用户选择第三方平台登录
2. 重定向到第三方认证页面
3. 用户授权后获取授权码
4. 通过授权码获取访问Seesion
5. 获取用户信息并绑定或创建账户
6. 生成系统访问Seesion

### 微信认证流程
1. 用户通过微信小程序或公众号发起登录
2. 获取微信授权码
3. 通过授权码获取微信用户信息
4. 绑定或创建系统账户
5. 生成系统访问Seesion

### 双因素认证流程
1. 用户输入邮箱或手机号
2. 系统发送验证码
3. 用户输入验证码
4. 系统验证验证码
5. 完成认证并生成访问Seesion

## 安全特性

### 多层次认证
- 支持多种认证方式的组合使用
- 双因素认证增强安全性
- 会话管理和Seesion刷新机制

### 数据安全
- 敏感信息加密存储
- 验证码有效期控制
- 防暴力破解机制

### 访问控制
- 基于角色的权限控制
- API接口访问限制
- 操作日志记录和审计

## 应用场景

- **企业应用**: 提供统一的企业级身份认证解决方案
- **互联网应用**: 支持多种社交平台登录，提升用户体验
- **移动应用**: 支持微信小程序等移动端认证方式
- **高安全场景**: 提供双因素认证，满足高安全要求

## 扩展能力

### 新增认证方式
- 遵循现有接口规范，可轻松添加新的认证方式
- 模块化设计便于独立开发和测试
- 配置化管理支持动态启用或禁用认证方式

### 集成能力
- 标准化接口便于与其他系统集成
- 支持自定义认证流程和业务逻辑
- 灵活的用户信息映射和同步机制

## 模块特点

- **全面性**: 覆盖主流认证方式，满足多样化需求
- **安全性**: 多层次安全验证，保障系统安全
- **灵活性**: 模块化设计，支持灵活配置和组合使用
- **易用性**: 标准化接口，降低集成和使用难度
- **可扩展性**: 开放架构设计，便于功能扩展和定制