# datai-file-local 模块说明文档

## 模块概述

datai-file-local 是 datai-scene-file 场景的本地文件存储实现模块，提供基于本地文件系统的文件存储服务。该模块实现了 StorageBucket 接口，为应用程序提供可靠的本地文件存储能力，支持普通文件上传、分片上传、文件访问控制等功能。

## 核心功能

### 1. 本地文件存储
- 实现基于本地文件系统的文件存储，支持文件上传、下载和删除操作
- 提供灵活的存储路径配置，可根据需求设置不同的存储根目录
- 自动创建必要的目录结构，确保文件存储的可靠性

### 2. 文件访问控制
- 支持公共文件和私有文件两种访问权限控制
- 为公共文件提供直接的URL访问路径，通过Spring MVC资源处理器实现
- 为私有文件生成带签名的预签名URL，提供安全的临时访问机制

### 3. 分片上传支持
- 实现完整的分片上传流程，包括初始化、分片上传和合并操作
- 使用临时目录存储分片文件，确保上传过程的可靠性
- 提供分片验证机制，确保合并后的文件完整性

### 4. 配置管理
- 提供灵活的配置属性，包括存储路径、权限设置和API路径
- 支持多存储桶配置，可根据不同业务需求创建多个本地存储实例
- 通过条件注解实现按需启用，提高系统灵活性

## 主要特性

### 1. 高可靠性
- 使用文件系统的原生特性确保数据持久化
- 实现分片上传的原子性操作，避免上传过程中的数据损坏
- 提供完整的错误处理机制，确保异常情况下的系统稳定性

### 2. 性能优化
- 使用NIO技术提高文件操作性能
- 实现高效的文件分片合并算法，减少内存占用
- 支持大文件处理，通过分片机制避免内存溢出

### 3. 安全机制
- 实现基于MD5的文件完整性校验
- 提供预签名URL机制，确保私有文件的安全访问
- 支持文件访问权限控制，防止未授权访问

### 4. 易于集成
- 实现标准的StorageBucket接口，与文件管理系统无缝集成
- 提供Spring Boot自动配置，简化集成过程
- 支持通过配置文件灵活调整存储参数

## 模块定位

datai-file-local 作为文件存储场景的基础实现，为系统提供：
- 轻量级的本地文件存储解决方案
- 快速、可靠的文件访问能力
- 适合中小型应用的文件管理功能
- 开发和测试环境的文件存储支持

该模块是文件存储系统的最基础实现，适用于对存储性能要求不高、文件访问量较小的应用场景，同时也可作为其他存储模块的参考实现。