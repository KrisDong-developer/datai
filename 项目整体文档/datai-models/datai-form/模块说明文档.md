# datai-form 模块说明文档

## 模块概述

datai-form 是 DataI 项目中的表单管理模块，负责系统中的动态表单设计与数据管理功能。该模块提供了完整的表单生命周期管理能力，包括表单模板设计、表单数据存储、表单状态管理和表单版本控制等核心功能。通过采用 JSON Schema 存储表单结构，实现了高度灵活的表单设计能力，能够满足企业级应用中复杂多变的表单需求。该模块是系统中数据采集和业务流程的重要基础组件，为其他模块提供了强大的表单支持能力。

## 核心功能

### 1. 表单模板管理
| 功能 | 描述 | 实现类 |
|------|------|--------|
| 表单模板创建 | 支持创建新的表单模板，定义表单结构和字段 | FormTemplateController:add |
| 表单模板查询 | 提供表单模板列表查询和分页功能 | FormTemplateServiceImpl:selectFormTemplateList |
| 表单模板修改 | 支持表单模板的结构和属性修改 | FormTemplateServiceImpl:updateFormTemplate |
| 表单模板删除 | 提供表单模板的安全删除功能 | FormTemplateServiceImpl:deleteFormTemplateByFormIds |
| 表单模板导出 | 支持表单模板数据的Excel导出功能 | FormTemplateController:export |
| 表单版本管理 | 支持表单模板的版本控制和语义化版本管理 | FormTemplate:formVersion |
| 表单状态管理 | 支持表单模板的发布状态管理（草稿、已发布、已停用） | FormTemplate:formStatus |

### 2. 表单数据管理
| 功能 | 描述 | 实现类 |
|------|------|--------|
| 表单数据创建 | 支持基于表单模板创建新的表单数据实例 | FormDataController:add |
| 表单数据查询 | 提供表单数据列表查询和分页功能 | FormDataServiceImpl:selectFormDataList |
| 表单数据修改 | 支持表单数据内容的修改和更新 | FormDataServiceImpl:updateFormData |
| 表单数据删除 | 提供表单数据的安全删除功能 | FormDataServiceImpl:deleteFormDataByDataIds |
| 表单数据导出 | 支持表单数据的Excel导出功能 | FormDataController:export |
| 表单状态跟踪 | 支持表单数据状态管理（草稿、已提交、已批准、已拒绝） | FormData:status |
| 表单版本关联 | 维护表单数据与表单模板版本的关联关系 | FormData:formVersion |

### 3. 表单结构设计
| 功能 | 描述 | 实现类 |
|------|------|--------|
| JSON Schema 存储 | 使用 JSON Schema 存储表单结构和字段定义 | FormTemplate:formSchema |
| vForm 配置支持 | 支持 vForm 前端表单设计器的配置格式 | FormTemplate:formSchema |
| 动态表单渲染 | 支持基于 JSON Schema 的动态表单渲染 | FormData:dataContent |
| 表单数据序列化 | 支持表单数据的 JSON 格式存储和读取 | FormData:dataContent |

## 依赖关系

### 核心依赖
| 依赖项 | 版本 | 用途 |
|--------|------|------|
| datai-common | 项目版本 | 依赖通用模块，获取基础工具类、注解和领域模型 |

### 依赖特点
- **轻量级设计**：仅依赖 datai-common 模块，保持模块的轻量化和独立性
- **基础功能支撑**：通过 datai-common 获取基础的数据访问、安全控制和工具类支持
- **扩展性良好**：简洁的依赖结构使模块具有良好的扩展性和集成性

## 模块架构

### 分层结构
```
datai-form/
├── controller/          # REST API控制层
│   ├── FormDataController.java     # 表单数据控制器
│   └── FormTemplateController.java # 表单模板控制器
├── service/             # 业务逻辑层
│   ├── IFormDataService.java       # 表单数据服务接口
│   ├── IFormTemplateService.java   # 表单模板服务接口
│   └── impl/                      # 服务实现类
│       ├── FormDataServiceImpl.java      # 表单数据服务实现
│       └── FormTemplateServiceImpl.java  # 表单模板服务实现
├── mapper/              # 数据访问层
│   ├── FormDataMapper.java         # 表单数据映射接口
│   └── FormTemplateMapper.java     # 表单模板映射接口
├── domain/              # 领域模型层
│   ├── FormData.java               # 表单数据实体
│   └── FormTemplate.java           # 表单模板实体
└── resources/
    └── mapper/           # MyBatis 映射文件
        ├── FormDataMapper.xml      # 表单数据映射配置
        └── FormTemplateMapper.xml  # 表单模板映射配置
```

### 核心实体
- **FormTemplate**：表单模板实体，包含表单结构定义、版本信息和发布状态
- **FormData**：表单数据实体，包含表单数据内容、状态信息和关联关系

### 关键字段说明
- **formSchema**：表单 JSON Schema，存储表单结构和字段定义
- **dataContent**：表单数据内容，以 JSON 格式存储表单数据
- **formVersion**：表单版本，支持语义化版本管理
- **status**：状态字段，支持表单模板和表单数据的状态管理

## 模块特点

1. **灵活的表单设计能力**：通过 JSON Schema 存储表单结构，支持动态表单设计和渲染
2. **完整的版本管理**：支持表单模板的版本控制和表单数据与版本的关联管理
3. **状态管理机制**：提供表单模板和表单数据的完整状态管理能力
4. **轻量级架构**：模块依赖简洁，保持轻量化和高内聚低耦合的设计原则
5. **标准化接口**：提供标准的 REST API 接口，便于集成和扩展
6. **数据导出能力**：支持表单模板和表单数据的 Excel 导出功能

## 总结

datai-form 模块是 DataI 项目中负责表单管理的核心组件，通过提供灵活的表单设计和数据管理能力，为系统中的数据采集和业务流程提供了强大支持。该模块采用 JSON Schema 存储表单结构，实现了高度灵活的表单设计能力，同时通过版本管理和状态管理机制，确保了表单数据的完整性和可追溯性。模块架构清晰，依赖简洁，具有良好的扩展性和集成性，是构建企业级应用表单管理功能的理想选择。通过与工作流模块等其他系统的集成，该模块能够满足复杂业务场景下的表单需求，为企业数字化转型提供有力支撑。