# datai-message 模块说明文档

## 1. 模块概述

datai-message 是消息管理模块，负责系统内消息的发送、接收、存储和管理功能。该模块提供了完整的消息生命周期管理，包括消息模板管理、消息变量管理、消息发送和接收等功能。支持多种消息类型和发送方式，通过AOP切面技术实现消息日志的自动记录，为系统提供了灵活、可扩展的消息通知机制。

## 2. 核心功能

| 功能类别 | 功能名称 | 功能描述 |
|---------|---------|---------|
| 消息管理 | 消息发送 | 支持单条和批量消息发送，可指定接收人和发送方式 |
| 消息管理 | 消息接收 | 接收并存储系统内各类消息，支持消息状态管理 |
| 消息管理 | 消息状态管理 | 管理消息的已读/未读状态，支持状态变更 |
| 消息管理 | 消息查询 | 提供多维度消息查询功能，支持按类型、状态等条件筛选 |
| 模板管理 | 模板创建 | 创建和管理消息模板，支持富文本内容 |
| 模板管理 | 模板变量 | 定义模板中的变量，实现动态内容替换 |
| 模板管理 | 模板应用 | 应用模板生成标准化消息内容 |
| 变量管理 | 变量定义 | 定义系统中可复用的消息变量 |
| 变量管理 | 变量分类 | 支持不同类型的变量分类管理 |
| 系统集成 | 资源查询 | 查询系统内的角色、部门、用户等资源信息 |
| 系统集成 | 多发送方式 | 支持平台内消息、手机短信、电子邮件等多种发送方式 |
| 日志记录 | AOP消息日志 | 通过注解和切面自动记录操作日志为消息 |

## 3. 模块架构

datai-message 模块采用分层架构设计，主要包含以下层次：

- **控制层(Controller)**: 提供RESTful API接口，处理消息管理、模板管理和变量管理的HTTP请求
- **服务层(Service)**: 实现消息管理的核心业务逻辑，包括消息处理、模板应用、变量替换等
- **数据访问层(Mapper)**: 负责与数据库交互，实现消息、模板、变量的持久化操作
- **工具层(Util)**: 提供消息处理所需的工具类，如AOP切面处理消息日志等
- **领域模型层(Domain)**: 定义消息管理相关的实体类，如MessageSystem、MessageTemplate、MessageVariable等
- **枚举层(Enums)**: 定义消息类型、发送方式等枚举值，规范系统中的消息分类
- **注解层(Annotation)**: 提供自定义注解，简化消息日志记录的操作

## 4. 主要依赖

| 依赖名称 | 依赖说明 | 用途 |
|---------|---------|------|
| datai-framework | 系统框架模块 | 提供Spring Security、AOP等框架支持 |
| datai-common | 通用工具模块 | 提供基础工具类、常量和通用功能 |
| datai-auth-starter | 认证启动器 | 提供用户认证和授权功能 |

## 5. 关键特性

1. **多消息类型支持**: 支持信息、警告、错误、调试、成功等多种消息类型，满足不同场景需求
2. **多发送方式**: 支持平台内消息、手机短信、电子邮件等多种发送方式，适应不同通知场景
3. **模板化管理**: 提供消息模板管理功能，支持变量替换，实现消息内容的标准化和复用
4. **AOP切面日志**: 通过自定义注解和AOP切面技术，实现操作日志自动转换为系统消息
5. **状态管理**: 完整的消息状态管理机制，支持已读/未读状态跟踪和变更
6. **系统集成能力**: 提供系统资源查询接口，可获取角色、部门、用户等信息，支持定向消息发送
7. **批量处理**: 支持消息批量发送和处理，提高系统性能和用户体验
8. **权限控制**: 集成Spring Security框架，提供细粒度的消息操作权限控制

## 6. 模块总结

datai-message 作为消息管理模块，是整个DataI项目中实现系统内通信和通知的核心组件。它通过提供完整的消息生命周期管理，确保了系统内信息的高效传递和及时通知。模块采用模板化设计，提高了消息内容的标准化和复用性；通过AOP切面技术，实现了操作日志到系统消息的无缝转换；支持多种消息类型和发送方式，满足了不同场景下的通知需求。同时，模块与datai-framework、datai-common等基础模块紧密集成，确保了消息功能与系统整体架构的一致性。通过datai-message，系统可以构建高效、灵活的消息通知体系，提升用户体验和系统交互性。