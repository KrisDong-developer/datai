# datai-rabbitmq 模块说明文档

## 模块概述

datai-rabbitmq 是基于 RabbitMQ 消息队列的中间件集成模块，为 datai 项目提供可靠的消息传递能力。该模块封装了 RabbitMQ 的核心功能，提供了消息发送、接收和处理的完整解决方案，支持异步通信、系统解耦和流量削峰等企业级应用场景。

## 核心功能

### 1. 消息队列配置
- 提供基于 Spring Boot 的 RabbitMQ 自动配置
- 支持直连交换机(Direct Exchange)模式的消息路由
- 实现队列、交换机和绑定关系的声明式配置
- 支持持久化队列和交换机配置

### 2. 消息发送与接收
- 提供 RabbitTemplate 封装的消息发送能力
- 支持基于注解的消息监听器
- 实现消息的自动序列化和反序列化
- 支持自定义消息转换器

### 3. 消息处理机制
- 提供基于 @RabbitHandler 注解的消息处理方法
- 支持条件化启用消息监听功能
- 实现消息的统一格式处理

## 主要组件

### 1. DirectRabbitConfig
- RabbitMQ 核心配置类
- 负责队列、交换机和绑定的声明
- 配置消息转换器和监听器工厂
- 实现自定义的消息处理方法工厂

### 2. SendMessageController
- 消息发送的 REST API 控制器
- 提供消息发送的 HTTP 接口
- 封装消息格式和发送逻辑
- 支持匿名访问的消息发送端点

### 3. RabbitMessageListener
- 消息监听器组件
- 实现消息的接收和处理
- 支持条件化启用监听功能
- 提供消息处理的核心逻辑

## 技术特点

### 1. 声明式配置
- 通过 @Bean 注解声明队列、交换机和绑定关系
- 支持持久化配置，确保消息不丢失
- 简化 RabbitMQ 的初始化配置过程

### 2. 消息转换机制
- 集成 Jackson2JsonMessageConverter 实现消息序列化
- 支持自定义消息类型映射
- 提供灵活的消息格式转换能力

### 3. 条件化启用
- 通过 @ConditionalOnProperty 注解实现条件化启用
- 支持通过配置文件控制消息监听器的启用状态
- 提供灵活的功能开关机制

### 4. 统一消息格式
- 使用 Message 类封装消息内容
- 支持消息载荷、发送者和接收者信息
- 提供标准化的消息结构

## 依赖关系

- **datai-common**：项目公共模块，提供基础工具和消息实体类
- **spring-boot-starter-amqp**：Spring Boot 的 AMQP 启动器，提供 RabbitMQ 集成支持

## 应用场景

1. **异步通信**：实现系统间的异步消息传递，提高系统响应速度
2. **系统解耦**：通过消息队列实现服务间的松耦合架构
3. **流量削峰**：在高并发场景下作为缓冲层，平滑处理突发流量
4. **任务分发**：实现任务的分布式处理和负载均衡
5. **事件驱动**：构建基于事件的系统架构，实现事件的发布和订阅

## 模块定位

datai-rabbitmq 模块是 datai 项目中的消息中间件解决方案，为系统提供可靠、高效的消息传递能力。它简化了 RabbitMQ 的使用复杂度，提供了一套完整的消息发送、接收和处理机制，使开发者能够轻松构建基于消息队列的分布式系统。

该模块的设计遵循 Spring Boot 的自动配置原则，通过声明式配置和注解驱动的开发模式，大大降低了消息队列的使用门槛，同时保持了足够的灵活性和扩展性。

## 使用优势

1. **简化集成**：提供开箱即用的 RabbitMQ 集成方案
2. **统一配置**：通过配置类统一管理 RabbitMQ 相关组件
3. **灵活控制**：支持条件化启用，满足不同环境需求
4. **标准化处理**：提供统一的消息格式和处理机制
5. **易于扩展**：基于 Spring 的架构设计，便于功能扩展和定制