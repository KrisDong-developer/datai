# datai-cache-ehcache 模块说明文档

## 模块概述

datai-cache-ehcache是基于Ehcache 3框架开发的本地缓存管理模块，为DataI系统提供高性能的内存缓存解决方案。该模块通过集成Ehcache和JSR-107(JCache)规范，实现了标准化的缓存管理和操作接口，支持多种缓存策略和过期机制。模块采用条件化配置方式，可根据需要灵活启用或禁用Ehcache缓存功能，与Spring Boot缓存抽象无缝集成，为系统提供快速的数据访问能力。

## 核心功能

| 功能类别 | 功能名称 | 功能描述 |
|---------|---------|---------|
| 缓存管理 | 缓存配置管理 | 提供基于JCache规范的缓存配置和管理功能 |
| 缓存管理 | 多缓存实例支持 | 支持同时管理多个缓存实例，满足不同业务场景需求 |
| 缓存管理 | 缓存生命周期管理 | 提供缓存的创建、初始化、销毁等完整生命周期管理 |
| 缓存策略 | 过期策略配置 | 支持基于创建时间的缓存过期策略，可自定义过期时长 |
| 缓存策略 | 存储策略配置 | 支持值引用和值拷贝两种存储策略，可根据需求选择 |
| 缓存操作 | 缓存键获取 | 提供获取缓存中所有键的功能，便于缓存管理和监控 |
| 缓存操作 | 缓存对象存储 | 提供泛型化的缓存对象存储接口，支持任意类型对象 |
| 缓存操作 | 缓存对象获取 | 提供类型安全的缓存对象获取接口 |
| 系统监控 | 缓存统计功能 | 支持缓存命中率、大小等统计信息收集 |
| 系统监控 | 缓存管理功能 | 支持缓存的运行时管理和监控操作 |
| 集成支持 | Spring集成 | 与Spring Boot缓存抽象无缝集成，支持注解式缓存操作 |

## 模块架构

datai-cache-ehcache模块采用轻量级架构设计，主要包括以下几个核心组件：

1. **配置层(Config)**：负责Ehcache缓存管理器的配置和初始化
   - Ehcache3Config：核心配置类，定义缓存管理器和缓存实例配置

2. **缓存实现层(Cache)**：提供缓存操作的具体实现
   - Ehcache3Cache：缓存操作实现类，实现CacheNoTimeOut和CacheKeys接口

3. **接口层(Interface)**：定义缓存操作的标准化接口
   - CacheNoTimeOut：无超时缓存操作接口
   - CacheKeys：缓存键管理接口

4. **适配层(Adapter)**：提供JCache规范的适配实现
   - JCacheCacheManager：JCache缓存管理器适配器
   - EhcacheCachingProvider：Ehcache JCache提供者

## 依赖关系

datai-cache-ehcache模块主要依赖以下组件：

| 依赖组件 | 版本 | 用途说明 |
|---------|------|---------|
| datai-common | 1.0.0 | 提供通用工具类和缓存接口定义 |
| ehcache | 3.9.x | Ehcache核心缓存框架 |
| spring-boot-starter-cache | 2.7.x | Spring Boot缓存抽象支持 |
| spring-boot-starter | 2.7.x | Spring Boot基础支持，提供自动配置和依赖注入 |
| cache-api | 1.1.x | JSR-107(JCache)缓存API规范 |

## 技术特点

1. **标准JCache支持**：完全符合JSR-107(JCache)规范，提供标准化的缓存接口

2. **高性能内存缓存**：基于Ehcache 3的高性能内存缓存实现，支持快速数据访问

3. **灵活的缓存策略**：支持多种缓存过期策略和存储策略，可根据业务需求灵活配置

4. **多缓存实例管理**：支持同时管理多个缓存实例，满足不同业务场景的缓存需求

5. **条件化启用**：支持通过配置开关控制缓存功能，提高系统灵活性

6. **Spring无缝集成**：与Spring Boot缓存抽象完全兼容，支持注解式缓存操作

7. **缓存监控支持**：提供缓存统计和管理功能，便于系统监控和优化

8. **类型安全操作**：提供泛型化的缓存操作接口，确保类型安全

## 预定义缓存

模块预配置了以下缓存实例，满足系统常见缓存需求：

| 缓存名称 | 用途说明 | 过期时间 |
|---------|---------|---------|
| temp_cache | 临时数据缓存 | 1小时 |
| eternal_cache | 永久数据缓存 | 1小时 |
| sys_dict | 系统字典缓存 | 1小时 |
| sys_config | 系统配置缓存 | 1小时 |
| repeat_submit | 重复提交防护 | 1小时 |
| captcha_codes | 验证码缓存 | 1小时 |
| login_tokens | 登录令牌缓存 | 1小时 |
| ip_err_cnt | IP错误计数 | 1小时 |
| rate_limit | 限流计数缓存 | 1小时 |
| pwd_err_cnt | 密码错误计数 | 1小时 |

## 应用场景

1. **系统配置缓存**：缓存系统配置参数，减少数据库访问频率

2. **字典数据缓存**：缓存数据字典信息，提高系统响应速度

3. **用户会话缓存**：缓存用户登录信息和会话数据，提升用户体验

4. **验证码缓存**：临时存储验证码信息，实现验证功能

5. **限流控制**：实现API访问频率限制，保护系统稳定性

6. **重复提交防护**：防止表单重复提交，保证数据一致性

7. **计算结果缓存**：缓存复杂计算结果，避免重复计算

8. **权限数据缓存**：缓存用户权限信息，提高权限验证效率

## 模块总结

datai-cache-ehcache作为DataI系统的本地缓存解决方案，通过集成Ehcache 3框架，提供了高性能、标准化的内存缓存管理能力。模块设计遵循了JSR-107(JCache)规范，采用条件化配置和自动装配机制，实现了与Spring Boot缓存抽象的无缝集成。通过提供灵活的缓存策略配置和多缓存实例管理，满足了各种业务场景下的缓存需求。该模块为DataI系统提供了快速的数据访问能力，有效降低了数据库访问压力，提升了系统整体性能，是系统高性能运行的重要支撑组件。