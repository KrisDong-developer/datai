# datai-netty 模块说明文档

## 模块概述

datai-netty 是基于 Netty 框架开发的高性能网络通信模块，提供了 WebSocket 和 TCP 长连接服务的实现能力。该模块封装了 Netty 的复杂配置，提供了一套简洁的注解和 API，使开发者能够快速构建实时通信服务。

## 核心功能

### 1. WebSocket 服务支持
- 提供基于 Netty 的 WebSocket 服务器实现
- 支持多路径、多端点的 WebSocket 连接管理
- 实现了连接生命周期管理（建立、消息接收、关闭、错误处理）
- 支持消息广播和单点发送功能

### 2. TCP 长连接服务
- 实现了 TCP 长连接服务器示例
- 支持客户端认证机制
- 内置心跳检测功能（PING/PONG）
- 提供消息回显服务

### 3. 注解驱动的端点配置
- 通过 `@NettyWebSocketEndpoint` 注解简化 WebSocket 端点定义
- 支持路径参数和查询参数的自动解析
- 提供灵活的消息处理机制

## 主要组件

### 1. NettyWebSocketServer
- WebSocket 服务器核心实现类
- 负责服务器的启动、配置和生命周期管理
- 支持 Boss 和 Worker 线程池配置
- 可通过配置文件控制服务器启用状态和端口

### 2. WebSocketHandler
- WebSocket 连接的核心处理器
- 管理所有活跃连接的通道组
- 实现消息路由和分发逻辑
- 处理握手升级和帧解析

### 3. NettyWebSocketEndpointHandler
- WebSocket 端点处理的抽象基类
- 定义了连接生命周期回调方法
- 提供消息发送和通道关闭的便捷方法
- 支持路径参数和查询参数的访问

### 4. 工具类支持
- CommonUtil：提供 URI 匹配、参数解析等工具方法
- 支持路径参数和查询参数的提取与转换

## 技术特点

### 1. 高性能网络通信
- 基于 Netty 的 NIO 模型，支持高并发连接
- 优化的线程模型和内存管理
- 零拷贝技术减少数据传输开销

### 2. 灵活的扩展性
- 抽象的端点处理器设计，便于业务逻辑扩展
- 注解驱动的开发模式，简化配置
- 支持自定义消息处理逻辑

### 3. 完善的连接管理
- 全面的连接生命周期管理
- 自动资源清理和异常处理
- 支持连接状态监控

## 依赖关系

- **netty-all**：Netty 框架核心依赖，提供网络通信能力
- **datai-common**：项目公共模块，提供基础工具和配置支持

## 应用场景

1. **实时通信系统**：聊天室、在线客服、实时通知等
2. **数据推送服务**：实时数据更新、监控数据推送等
3. **物联网通信**：设备状态监控、远程控制等
4. **游戏服务器**：多人在线游戏的实时通信
5. **API 网关**：作为微服务架构中的通信层

## 模块定位

datai-netty 模块是 datai 项目中的网络通信基础设施，为上层应用提供高性能的实时通信能力。它简化了 Netty 的使用复杂度，提供了一套完整的 WebSocket 和 TCP 服务解决方案，使开发者能够专注于业务逻辑的实现，而不需要处理底层网络通信的细节。