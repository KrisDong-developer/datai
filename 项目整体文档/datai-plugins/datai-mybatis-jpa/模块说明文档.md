# datai-mybatis-jpa 模块说明文档

## 模块概述

datai-mybatis-jpa 是 datai 框架中的 JPA 风格 MyBatis 增强模块，通过注解驱动的方式简化数据库操作。该模块提供了一套类似 JPA 的注解体系和通用数据访问接口，使开发者能够以更简洁、更面向对象的方式进行数据库操作，同时保持 MyBatis 的灵活性和性能优势。

## 核心功能

### 1. JPA 风格注解体系

模块提供了一套完整的 JPA 风格注解，用于描述实体类与数据库表的映射关系：

- **@Table**：标记实体类对应的数据库表名，支持指定查询字段和排序规则
- **@Column**：标记实体字段对应的数据库列名，支持主键标识
- **@Query**：标记查询条件，支持多种查询操作符和参数处理
- **@ColumnMap**：支持关联表字段映射
- **@EnableTableMap**：启用表映射功能

### 2. 通用数据访问接口

提供了标准化的数据访问接口和实现，简化 CRUD 操作：

- **JPAMapper**：基于 MyBatis Provider 的通用 Mapper 接口
- **JPAService**：业务层通用服务接口
- **JPAServiceImpl**：业务层通用服务实现

### 3. 动态 SQL 生成

通过 SQLGenerator 类实现动态 SQL 生成，支持：

- 根据实体类注解自动生成增删改查 SQL
- 支持复杂查询条件构建
- 支持表关联查询
- 支持数据权限过滤
- 支持动态排序

### 4. 查询条件枚举

定义了丰富的查询操作符枚举，满足各种查询需求：

- 基础比较：eq, ne, gt, ge, lt, le
- 模糊查询：like, notLike, likeLeft, likeRight, notLikeLeft, notLikeRight
- 范围查询：in, notIn, between, notBetween
- 空值判断：isNull, isNotNull
- 子查询：inSql, notInSql

## 主要组件

### 注解组件

- **@Table**：表级注解，定义表名、查询字段和排序规则
- **@Column**：字段级注解，定义列名和主键属性
- **@Query**：查询条件注解，定义查询操作符和参数处理方式
- **@ColumnMap**：关联字段映射注解
- **@EnableTableMap**：启用表映射功能注解

### 数据访问组件

- **JPAMapper**：通用数据访问接口，提供基础 CRUD 操作
- **JPAService**：业务层服务接口
- **JPAServiceImpl**：业务层服务实现

### 工具组件

- **SQLGenerator**：动态 SQL 生成器，根据实体注解生成各种 SQL 语句
- **TableContainer**：表信息容器，缓存表结构信息
- **QueryUtil**：查询工具类，处理查询条件转换
- **QueryWrapperUtil**：查询包装器工具

### 领域模型

- **TableInfo**：表信息模型，存储表结构、字段信息等
- **ColumnInfo**：字段信息模型，存储字段属性和映射关系
- **MapColumnInfo**：映射字段信息模型，处理关联字段
- **BaseColumnInfo**：基础字段信息模型

## 技术特点

1. **注解驱动**：通过注解方式定义映射关系，减少 XML 配置
2. **类型安全**：基于 Java 类型系统，提供编译时类型检查
3. **动态 SQL**：根据实体状态动态生成 SQL，提高灵活性
4. **缓存优化**：表信息缓存机制，减少反射开销
5. **扩展性强**：支持自定义注解和查询操作符
6. **兼容性好**：与 MyBatis 完全兼容，可无缝集成

## 依赖关系

模块依赖以下核心组件：

- **datai-common**：提供基础工具类和通用功能
- **mybatis-plus-spring-boot3-starter**：提供 MyBatis Plus 集成支持（可选依赖）

## 应用场景

1. **快速开发**：适用于需要快速实现基础 CRUD 操作的场景
2. **微服务架构**：适用于微服务中简化数据访问层的开发
3. **数据中台**：适用于数据中台中统一数据访问接口
4. **企业应用**：适用于企业应用中标准化数据访问层

## 使用方式

1. 在实体类上添加 @Table 注解定义表映射
2. 在字段上添加 @Column 注解定义列映射
3. 在查询字段上添加 @Query 注解定义查询条件
4. 继承 JPAMapper 接口或使用 JPAService 进行数据操作

## 扩展性

模块设计具有良好的扩展性，支持：

- 自定义注解扩展
- 自定义查询操作符
- 自定义 SQL 生成策略
- 自定义表信息解析器