# datai-admin 模块说明文档

## 1. 模块概述

**模块名称**：datai-admin
**模块定位**：系统Web管理界面，提供系统管理的前端访问入口
**模块版本**：1.0.0
**主要职责**：
- 提供系统管理的Web界面和REST API接口
- 实现各种管理功能的控制器层
- 配置系统的Web相关功能和启动入口
- API文档生成和配置
- 文件上传下载功能
- 验证码生成和验证
- 系统监控和管理功能
- 用户认证和权限管理
- 系统配置和字典管理
- 部门、角色、用户等系统核心功能管理

## 2. 核心功能

| 功能模块 | 功能描述 | 主要实现类/接口 |
|---------|---------|---------------|
| 系统启动 | 提供系统启动入口和Web容器配置 | DataIApplication, DataIServletInitializer |
| 用户认证 | 用户登录、注册、权限验证 | SysLoginController, SysRegisterController |
| 系统管理 | 用户、角色、部门、菜单等系统核心功能管理 | SysUserController, SysRoleController, SysDeptController, SysMenuController |
| 字典管理 | 系统字典类型和字典数据管理 | SysDictTypeController, SysDictDataController |
| 通用功能 | 文件上传下载、验证码生成 | CommonController, CaptchaController |
| 系统监控 | 缓存监控、服务器监控、日志管理 | monitor包下的控制器类 |
| 个人中心 | 个人信息管理、密码修改 | SysProfileController |
| 通知公告 | 系统通知公告管理 | SysNoticeController |
| 岗位管理 | 系统岗位信息管理 | SysPostController |
| 系统配置 | 系统参数配置管理 | SysConfigController |
| API文档 | 配置Swagger和Knife4j API文档 | SwaggerConfig, application-apidoc.yml |

## 3. 依赖关系

### 3.1 核心依赖

| 依赖名称 | 版本 | 用途 |
|---------|------|------|
| spring-boot-starter-actuator | - | 提供应用监控和管理功能 |
| spring-boot-devtools | - | 提供开发时热部署功能 |
| mysql-connector-j | - | MySQL数据库驱动 |
| postgresql | - | PostgreSQL数据库驱动 |
| knife4j-openapi3-jakarta-spring-boot-starter | - | API文档生成工具 |
| datai-framework | - | 核心框架模块 |
| datai-scene-starter | - | 场景启动器模块 |
| datai-plugins-starter | - | 插件启动器模块 |
| datai-models-starter | - | 业务模型启动器模块 |

### 3.2 依赖关系图

```
datai-admin
├── datai-framework (核心框架)
├── datai-scene-starter (场景启动器)
├── datai-plugins-starter (插件启动器)
├── datai-models-starter (业务模型启动器)
├── Spring Boot (基础框架)
│   ├── spring-boot-starter-actuator (监控)
│   ├── spring-boot-devtools (热部署)
│   └── spring-boot-starter-web (Web应用)
├── 数据库驱动
│   ├── mysql-connector-j (MySQL)
│   └── postgresql (PostgreSQL)
└── Knife4j (API文档)
```

## 4. 架构设计

### 4.1 模块结构

```
datai-admin/
└── src/
    └── main/
        ├── java/
        │   └── com/
        │       └── datai/
        │           ├── DataIApplication.java      # 应用程序启动类
        │           ├── DataIServletInitializer.java # Web容器初始化类
        │           └── web/
        │               ├── controller/    # 控制器层
        │               │   ├── common/    # 通用控制器
        │               │   │   ├── CaptchaController.java    # 验证码控制器
        │               │   │   └── CommonController.java    # 通用功能控制器
        │               │   ├── monitor/   # 监控控制器
        │               │   │   ├── CacheController.java     # 缓存监控控制器
        │               │   │   ├── ServerController.java    # 服务器监控控制器
        │               │   │   ├── SysLogininforController.java  # 登录日志控制器
        │               │   │   ├── SysOperlogController.java   # 操作日志控制器
        │               │   │   └── SysUserOnlineController.java # 在线用户控制器
        │               │   └── system/    # 系统管理控制器
        │               │       ├── SysConfigController.java   # 系统配置控制器
        │               │       ├── SysDeptController.java     # 部门管理控制器
        │               │       ├── SysDictDataController.java # 字典数据控制器
        │               │       ├── SysDictTypeController.java # 字典类型控制器
        │               │       ├── SysIndexController.java    # 系统首页控制器
        │               │       ├── SysLoginController.java    # 登录控制器
        │               │       ├── SysMenuController.java     # 菜单管理控制器
        │               │       ├── SysNoticeController.java   # 通知公告控制器
        │               │       ├── SysPostController.java     # 岗位管理控制器
        │               │       ├── SysProfileController.java  # 个人信息控制器
        │               │       ├── SysRegisterController.java # 注册控制器
        │               │       ├── SysRoleController.java     # 角色管理控制器
        │               │       └── SysUserController.java     # 用户管理控制器
        │               └── core/         # 核心配置
        │                   └── config/    # 配置类
        │                       └── SwaggerConfig.java         # API文档配置
        └── resources/
            ├── META-INF/                  # 元数据信息
            ├── i18n/                     # 国际化资源文件
            ├── mybatis/                  # MyBatis配置
            ├── pay/                      # 支付配置文件
            ├── application.yml           # 主配置文件
            ├── application-apidoc.yml     # API文档配置
            ├── application-auth.yml      # 认证配置
            ├── application-druid.yml     # 数据库连接池配置
            ├── application-file.yml      # 文件存储配置
            ├── application-model.yml     # 模型配置
            ├── application-pay.yml       # 支付配置
            ├── application-plugins.yml   # 插件配置
            ├── banner.txt                # 启动横幅
            └── logback.xml               # 日志配置
```

### 4.2 控制器结构

#### 4.2.1 通用控制器

| 控制器名称 | 功能描述 | 主要API |
|-----------|---------|---------|
| CaptchaController | 验证码生成和验证，支持数学计算和字符验证码 | /captchaImage |
| CommonController | 通用功能控制器，文件上传下载和资源访问 | /download, /upload, /uploads, /download/resource |

#### 4.2.2 监控控制器

| 控制器名称 | 功能描述 | 主要API |
|-----------|---------|---------|
| CacheController | 缓存监控和管理，支持查看和清理缓存 | /monitor/cache/* |
| ServerController | 服务器监控，获取CPU、内存、磁盘等系统信息 | /monitor/server |
| SysLogininforController | 登录日志管理，记录和查询用户登录信息 | /monitor/logininfor/* |
| SysOperlogController | 操作日志管理，记录和查询用户操作信息 | /monitor/operlog/* |
| SysUserOnlineController | 在线用户管理，查看和管理当前在线用户 | /monitor/online/* |

#### 4.2.3 系统管理控制器

| 控制器名称 | 功能描述 | 主要API |
|-----------|---------|---------|
| SysConfigController | 系统配置管理，管理系统参数配置 | /system/config/* |
| SysDeptController | 部门管理，管理组织架构信息 | /system/dept/* |
| SysDictDataController | 字典数据管理，管理系统字典数据 | /system/dict/data/* |
| SysDictTypeController | 字典类型管理，管理系统字典类型 | /system/dict/type/* |
| SysIndexController | 系统首页，显示系统欢迎信息 | / |
| SysLoginController | 登录控制器，处理用户登录认证 | /login, /getInfo, /getRouters |
| SysMenuController | 菜单管理，管理系统菜单和权限 | /system/menu/* |
| SysNoticeController | 通知管理，管理系统通知公告 | /system/notice/* |
| SysPostController | 岗位管理，管理系统岗位信息 | /system/post/* |
| SysProfileController | 个人信息管理，管理用户个人信息 | /system/user/profile/* |
| SysRegisterController | 注册控制器，处理用户注册 | /register |
| SysRoleController | 角色管理，管理系统角色和权限 | /system/role/* |
| SysUserController | 用户管理，管理系统用户信息 | /system/user/* |

## 5. 主要组件说明

### 5.1 系统启动组件

#### 5.1.1 DataIApplication

**功能**：系统启动入口类
**主要功能**：
- 配置Spring Boot应用启动
- 排除数据源自动配置
- 配置扫描包路径
- 显示启动成功信息和访问URL
- 提供本地和外部访问地址
- 集成Swagger和Knife4j文档访问地址

#### 5.1.2 DataIServletInitializer

**功能**：Web容器部署配置
**主要功能**：
- 支持将应用部署到外部Web容器
- 配置Spring Boot Servlet初始化
- 实现SpringBootServletInitializer接口

### 5.2 核心配置

#### 5.2.1 SwaggerConfig

**功能**：配置Swagger API文档生成
**主要功能**：
- 配置Swagger基本信息
- 配置API扫描路径
- 配置API分组
- 配置全局参数
- 定义AjaxResult的Schema
- 集成Knife4j增强文档功能

### 5.3 控制器组件

#### 5.3.1 CaptchaController

**功能**：处理验证码相关请求
**主要方法**：
- getCode：生成验证码（支持数学计算和字符验证码）
- 支持验证码类型配置（math/char）
- 验证码缓存到Redis
- 支持验证码开关配置

#### 5.3.2 CommonController

**功能**：处理通用请求
**主要方法**：
- fileDownload：通用文件下载
- uploadFile：单文件上传
- uploadFiles：多文件上传
- resourceDownload：本地资源下载
- 支持多种文件存储方式（本地/Minio/OSS）
- 文件安全检查和防盗链保护

#### 5.3.3 SysLoginController

**功能**：处理用户登录相关请求
**主要方法**：
- login：处理用户登录请求
- getInfo：获取用户信息
- getRouters：获取路由信息
- 密码过期检查和初始密码修改提醒
- 用户权限和角色信息获取
- Token刷新机制

#### 5.3.4 SysIndexController

**功能**：系统首页控制器
**主要方法**：
- index：返回系统首页信息
- 显示系统名称和版本信息

#### 5.3.5 CacheController

**功能**：缓存监控和管理
**主要方法**：
- cache：获取缓存名列表
- getCacheKeys：获取缓存键列表
- getCacheValue：获取缓存值
- clearCacheName：清除指定缓存
- clearCacheKey：清除指定缓存键
- clearCacheAll：清除所有缓存
- 支持多种缓存类型监控（登录信息、配置信息、字典数据等）

#### 5.3.6 ServerController

**功能**：服务器监控
**主要方法**：
- getInfo：获取服务器监控信息（CPU、内存、磁盘等）
- 系统运行状态实时监控

## 6. 配置文件说明

### 6.1 主配置文件 application.yml

**功能**：系统主配置文件
**主要配置项**：
- 项目基本信息（名称、版本、文件路径等）
- 服务器配置（端口、Servlet路径、Tomcat配置）
- 日志配置（日志级别、输出格式）
- 用户配置（密码策略、IP限制）
- Spring配置（缓存、国际化、文件上传等）
- Token配置（密钥、有效期）
- 安全配置（防盗链、XSS防护）
- MyBatis/MyBatis Plus配置
- 分页插件配置
- 数据范围和权限配置

### 6.2 数据库配置 application-druid.yml

**功能**：数据库连接池配置
**主要配置项**：
- 数据源类型和驱动
- 主从数据源配置
- 连接池参数（初始连接数、最小/最大连接数等）
- 连接超时配置
- Druid监控配置
- SQL防火墙配置
- 分布式事务配置

### 6.3 文件存储配置 application-file.yml

**功能**：文件存储配置
**主要配置项**：
- 本地存储配置（路径、权限、API）
- Minio存储配置（URL、访问密钥、桶配置）
- 阿里云OSS存储配置（访问密钥、桶配置、端点）
- 存储桶权限和路径配置
- 多存储源支持

### 6.4 认证配置 application-auth.yml

**功能**：第三方认证和双因素认证配置
**主要配置项**：
- 微信小程序/公众号配置（AppID、AppSecret）
- 短信服务配置（阿里云短信服务）
- JustAuth社交登录配置（Gitee、GitHub等）
- 邮件服务配置（SMTP服务器、认证信息）

### 6.5 支付配置 application-pay.yml

**功能**：支付服务配置
**主要配置项**：
- 收钱吧支付配置
- 支付宝支付配置
- 微信支付配置
- 回调地址配置
- 支付证书配置

### 6.6 插件配置 application-plugins.yml

**功能**：插件服务配置
**主要配置项**：
- Redis配置（连接池、超时、缓存配置）
- RabbitMQ配置（消息队列）
- Netty WebSocket配置（实时通信）
- 插件开关和参数配置

### 6.7 模型配置 application-model.yml

**功能**：代码生成和工作流配置
**主要配置项**：
- 代码生成器配置（作者、包路径、表前缀）
- Flowable工作流配置（定时任务、数据库架构更新）

### 6.8 API文档配置 application-apidoc.yml

**功能**：API文档生成配置
**主要配置项**：
- Swagger开关和路径映射
- API分组配置（系统模块、基础模块、支付模块等）
- SpringDoc配置

