# datai-system 模块说明文档

## 1. 模块概述

**模块名称**：datai-system
**模块定位**：系统核心管理模块，提供完整的系统管理功能，包括用户管理、角色权限管理、菜单管理、部门管理、岗位管理等核心功能
**模块版本**：1.0.0
**主要职责**：
- 提供完整的用户生命周期管理功能，包括用户注册、认证、授权和信息维护
- 实现基于RBAC模型的角色权限管理体系，支持细粒度权限控制
- 提供灵活的菜单管理功能，支持动态菜单生成和权限控制
- 管理系统配置参数，支持系统运行时配置动态更新
- 记录系统操作日志和登录日志，提供系统安全审计能力
- 提供岗位管理和部门管理功能，支持企业组织架构管理
- 提供系统通知公告管理功能，支持系统消息推送
- 管理在线用户信息，支持会话监控和管理

## 2. 核心功能

| 功能模块 | 功能描述 | 主要实现类/接口 |
|---------|---------|---------------|
| 用户管理 | 提供用户的增删改查、状态管理、密码重置、角色分配、岗位分配等功能 | ISysUserService, SysUserServiceImpl |
| 角色管理 | 提供角色的增删改查、权限分配、数据权限控制等功能 | ISysRoleService, SysRoleServiceImpl |
| 菜单管理 | 提供菜单的增删改查、权限分配、路由生成等功能 | ISysMenuService, SysMenuServiceImpl |
| 部门管理 | 提供部门的增删改查、树形结构管理等功能 | ISysDeptService, SysDeptServiceImpl |
| 岗位管理 | 提供岗位的增删改查、状态管理等功能 | ISysPostService, SysPostServiceImpl |
| 系统配置 | 提供系统配置管理功能，支持运行时配置更新 | ISysConfigService, SysConfigServiceImpl |
| 登录日志 | 记录用户登录日志，提供登录行为分析 | ISysLogininforService, SysLogininforServiceImpl |
| 操作日志 | 记录系统操作日志，提供操作审计功能 | ISysOperLogService, SysOperLogServiceImpl |
| 系统通知 | 提供系统通知公告管理功能，支持通知发布和状态管理 | ISysNoticeService, SysNoticeServiceImpl |
| 在线用户 | 管理在线用户信息，支持会话监控和强制下线 | ISysUserOnlineService, SysUserOnlineServiceImpl |
| 字典管理 | 提供系统字典数据管理功能，支持字典类型和字典项管理 | ISysDictTypeService, ISysDictDataService |

## 3. 架构设计

### 3.1 模块结构

```
datai-system/
└── src/
    └── main/
        └── java/
            └── com/
                └── datai/
                    └── system/
                        ├── domain/        # 领域模型
                        │   └── vo/        # 视图对象
                        ├── mapper/        # MyBatis映射器
                        └── service/       # 服务层
                            └── impl/      # 服务实现
```

### 3.2 核心实体关系

```
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│    SysUser      │      │    SysRole      │      │    SysMenu      │
└─────────┬───────┘      └─────────┬───────┘      └─────────┬───────┘
          │                      │                      │
          │                      │                      │
          ▼                      ▼                      ▼
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│  SysUserRole    │      │  SysRoleMenu    │      │   SysConfig     │
└─────────────────┘      └─────────────────┘      └─────────────────┘
          │                      │
          │                      │
          ▼                      ▼
┌─────────────────┐      ┌─────────────────┐
│   SysPost       │      │  SysOperLog     │
└─────────┬───────┘      └─────────────────┘
          │
          │
          ▼
┌─────────────────┐
│  SysUserPost    │
└─────────────────┘
```

## 4. 主要实体说明

### 4.1 SysCache

**功能**：系统缓存信息实体
**主要字段**：
- cacheName：缓存名称
- cacheValue：缓存值
- cacheKey：缓存键
- expireTime：过期时间

### 4.2 SysConfig

**功能**：系统配置实体
**主要字段**：
- configId：配置ID
- configName：配置名称
- configKey：配置键名
- configValue：配置值
- configType：配置类型
- createBy：创建者
- createTime：创建时间
- updateBy：更新者
- updateTime：更新时间
- remark：备注

### 4.3 SysLogininfor

**功能**：系统登录日志实体
**主要字段**：
- infoId：日志ID
- username：用户名
- ipaddr：登录IP地址
- loginLocation：登录地点
- browser：浏览器类型
- os：操作系统
- status：登录状态
- msg：提示消息
- loginTime：登录时间

### 4.4 SysNotice

**功能**：系统通知实体
**主要字段**：
- noticeId：通知ID
- noticeTitle：通知标题
- noticeType：通知类型
- noticeContent：通知内容
- status：状态
- createBy：创建者
- createTime：创建时间
- updateBy：更新者
- updateTime：更新时间
- remark：备注

### 4.5 SysOperLog

**功能**：系统操作日志实体
**主要字段**：
- operId：日志ID
- title：模块标题
- businessType：业务类型
- method：方法名称
- requestMethod：请求方式
- operatorType：操作类别
- operName：操作人员
- deptName：部门名称
- operUrl：请求URL
- operIp：操作IP
- operLocation：操作地点
- operParam：请求参数
- jsonResult：返回参数
- status：操作状态
- errorMsg：错误消息
- operTime：操作时间

### 4.6 SysPost

**功能**：岗位实体
**主要字段**：
- postId：岗位ID
- postCode：岗位编码
- postName：岗位名称
- postSort：显示顺序
- status：状态
- createBy：创建者
- createTime：创建时间
- updateBy：更新者
- updateTime：更新时间
- remark：备注

### 4.7 SysRoleDept

**功能**：角色和部门关联实体
**主要字段**：
- roleId：角色ID
- deptId：部门ID

### 4.8 SysRoleMenu

**功能**：角色和菜单关联实体
**主要字段**：
- roleId：角色ID
- menuId：菜单ID

### 4.9 SysUserOnline

**功能**：在线用户实体
**主要字段**：
- tokenId：令牌ID
- userId：用户ID
- loginName：登录账号
- deptName：部门名称
- ipaddr：登录IP地址
- loginLocation：登录地点
- browser：浏览器类型
- os：操作系统
- loginTime：登录时间

### 4.10 SysUserPost

**功能**：用户和岗位关联实体
**主要字段**：
- userId：用户ID
- postId：岗位ID

### 4.11 SysUserRole

**功能**：用户和角色关联实体
**主要字段**：
- userId：用户ID
- roleId：角色ID

## 5. 服务层设计

### 5.1 核心服务接口

| 服务接口 | 功能描述 | 实现类 |
|---------|---------|-------|
| ISysUserService | 用户管理服务 | SysUserServiceImpl |
| ISysRoleService | 角色管理服务 | SysRoleServiceImpl |
| ISysMenuService | 菜单管理服务 | SysMenuServiceImpl |
| ISysDeptService | 部门管理服务 | SysDeptServiceImpl |
| ISysPostService | 岗位管理服务 | SysPostServiceImpl |
| ISysConfigService | 系统配置服务 | SysConfigServiceImpl |

## 6. 使用示例

### 6.1 用户管理示例

```java
// 用户登录
SysUser user = sysUserService.login(user.getUserName(), user.getPassword());

// 查询用户列表
List<SysUser> userList = sysUserService.selectUserList(user);

// 添加用户
sysUserService.insertUser(user);

// 更新用户
sysUserService.updateUser(user);

// 删除用户
sysUserService.deleteUserById(userId);
```

### 6.2 角色管理示例

```java
// 查询角色列表
List<SysRole> roleList = sysRoleService.selectRoleList(role);

// 添加角色
sysRoleService.insertRole(role);

// 分配角色菜单
sysRoleService.insertRoleMenu(roleId, menuIds);

// 删除角色
sysRoleService.deleteRoleById(roleId);
```

### 6.3 菜单管理示例

```java
// 查询菜单列表
List<SysMenu> menuList = sysMenuService.selectMenuList(menu);

// 添加菜单
sysMenuService.insertMenu(menu);

// 更新菜单
sysMenuService.updateMenu(menu);

// 删除菜单
sysMenuService.deleteMenuById(menuId);
```

## 7. 依赖关系

| 依赖模块 | 版本 | 用途 |
|---------|------|------|
| datai-common | 1.0.0 | 提供通用工具类、基础实体类、异常处理、安全框架等核心支持 |

**依赖说明**：
- datai-system 模块采用轻量级设计，仅依赖 datai-common 模块
- datai-common 模块提供了系统所需的基础实体类（如 SysUser、SysRole、SysMenu 等）
- 通过 datai-common 模块间接使用了 Spring Boot、MyBatis、Spring Security 等框架
- 这种设计降低了模块间的耦合度，提高了系统的可维护性和可扩展性

## 8. 部署方式

作为系统核心模块，datai-system不需要单独部署，而是作为依赖被其他模块引用，随主应用一起部署。

## 9. 维护指南

### 9.1 常见问题及解决方案

| 问题 | 可能原因 | 解决方案 |
|------|---------|---------|
| 用户登录失败 | 密码错误、账号不存在等 | 检查用户名密码是否正确，确认账号状态 |
| 权限不足 | 角色权限配置错误 | 检查角色权限配置，重新分配权限 |
| 菜单不显示 | 菜单权限配置错误 | 检查菜单权限配置，重新分配权限 |
| 日志记录失败 | 数据库连接问题 | 检查数据库连接，确保数据库正常运行 |

### 9.2 扩展建议

- 当需要添加新的系统功能时，应在domain包下添加对应的实体类
- 当需要扩展服务层功能时，应在service包下添加对应的服务接口和实现类
- 当需要添加新的权限控制时，应在security包下添加对应的权限处理器

## 10. 总结

datai-system模块是系统的核心管理模块，负责系统用户、角色、菜单、权限等核心功能的实现。该模块采用经典的三层架构设计，包含领域模型、数据访问层和服务层，实现了完整的RBAC权限管理模型。

**模块特点**：
1. **完整的权限管理体系**：基于RBAC模型，实现了用户-角色-权限的完整权限管理链路
2. **灵活的菜单管理**：支持动态菜单生成，可根据用户权限动态展示菜单结构
3. **全面的日志记录**：提供登录日志和操作日志记录，支持系统安全审计
4. **细粒度的数据权限**：支持数据级别的权限控制，实现不同角色的数据隔离
5. **轻量级设计**：仅依赖datai-common模块，降低系统复杂度，提高可维护性

**核心价值**：
1. **安全保障**：通过完善的权限管理和日志记录，保障系统安全
2. **管理便捷**：提供直观的用户、角色、菜单管理界面，简化系统管理
3. **扩展性强**：模块化设计，便于功能扩展和定制开发
4. **性能优化**：合理的数据库设计和查询优化，保证系统性能

通过合理使用该模块提供的功能，可以实现系统的用户管理、权限控制、日志记录等核心功能，保证系统的安全性和可靠性。该模块的设计遵循了高内聚、低耦合的原则，便于维护和扩展，是企业级应用系统不可或缺的核心组件。