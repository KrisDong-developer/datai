# 项目规则 (Project Rules)

## 权限与真理来源 (Hierarchy of Truth)

### 唯一真理来源
- `docs/` 目录是项目所有行动的唯一真理来源
- 所有决策、设计和文档必须以 `docs/` 目录中的内容为准

### 三步检索流程
AI 在执行任何操作前必须执行以下三步检索：
1. **读取 README.md** - 了解项目目标与真源入口
2. **读取 docs/index.md** - 查看资产索引和文档结构
3. **解析 docs/design/Authentication.canvas** - 分析视觉逻辑图，确保代码实现与 Canvas 节点标签（Node Label）100% 对应

### 真理优先级
1. Canvas 视觉逻辑图 > 代码实现
2. ADR 架构决策 > 临时方案
3. 文档规范 > 个人习惯

## 决策驱动开发 (ADR Enforcement)

### ADR 强制要求
- 任何涉及以下方面的改动，必须首先检查或创建 `docs/decisions/adr/` 下的文档：
  - 架构变更
  - 数据结构调整
  - 鉴权流程修改
  - 核心模块重构

### 禁止事项
- 严禁在没有 ADR 支持的情况下进行大规模重构
- 严禁跳过决策流程直接实施重大变更

### ADR 流程
1. 创建 ADR 草案
2. 团队审核
3. 获得批准后实施
4. 更新相关文档和 Canvas

## 指令驱动开发 (Prompt-First Protocol)

### Prompt 优先原则
- 强制执行 `docs/prompts/` 规范
- 对于复杂功能，必须先要求用户确认或更新对应的 Prompt 模板
- 严禁脱离文档盲写代码

### Prompt 模板使用
- 所有复杂操作必须基于 `docs/prompts/0000-template.md` 创建专用 Prompt
- Prompt 必须包含：输入引用、目标、输出格式、约束、验收标准、风险、使用记录

### 指令执行流程
1. 分析任务需求
2. 查找或创建对应的 Prompt 模板
3. 与用户确认 Prompt 内容
4. 基于 Prompt 执行任务
5. 验证结果是否符合 Prompt 要求

## 自动化文档维护 (Auto-Maintenance)

### 索引自动更新
- 每当在 `docs/` 下创建新文件，AI 必须主动更新 `docs/index.md`
- 更新必须包含：文件路径、描述、创建日期

### 会话自动归档
- 任务结束时，必须按 `docs/sessions/` 模板生成会话记录
- 会话记录必须包含：现状、目标、引用链接、关键决策、回滚步骤
- 提醒用户同步更新 Canvas 画布

### 变更自动记录
- 所有重要变更必须在 `docs/changelog/` 中记录
- 记录必须包含：变更内容、影响范围、实施人员、日期

## 操作指令集 (Trigger Commands)

### 关键词触发
- `/session` - 自动归档当前会话
- `/adr` - 启动架构决策记录起草
- `/prompt` - 创建或更新 Prompt 模板
- `/canvas` - 检查并提醒更新 Canvas 画布
- `/index` - 更新 docs/index.md 索引

### 指令执行逻辑
1. 用户输入触发指令
2. AI 识别指令类型
3. 执行对应操作
4. 生成操作结果报告

## 违规处理

### 轻微违规
- 提醒用户并要求修正
- 记录在会话归档中

### 严重违规
- 拒绝执行操作
- 要求用户确认正确的流程
- 必要时请求人工干预

## 规则更新

### 更新流程
1. 提出规则变更建议
2. 创建 ADR 记录
3. 团队审核
4. 批准后更新规则文件
5. 通知所有团队成员

### 版本控制
- 规则文件必须通过 Git 进行版本控制
- 每次更新必须记录变更原因和影响

## 生效时间

本规则自创建之日起生效，适用于所有项目相关的 AI 操作。