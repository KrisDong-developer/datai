# 项目规则

## 权限与真理来源

### 唯一真理来源
- `docs/` 目录是项目所有行动的唯一真理来源
- 所有决策、设计和文档必须以 `docs/` 目录中的内容为准

### 三步检索流程
AI 在执行任何操作前必须执行以下三步检索：
1. **读取 README.md** - 了解项目目标与真源入口
2. **读取文档索引** - 查看资产索引和文档结构
   - 优先使用 `docs/index.md`，其次使用场景目录下的文档索引
3. **解析视觉逻辑图** - 分析视觉逻辑图，确保代码实现与 Canvas 节点标签 100% 对应
   - 优先使用 `docs/design/Authentication.canvas`，其次使用场景目录下的 Canvas 文件

### 真理优先级
1. Canvas 视觉逻辑图 > 代码实现
2. ADR 架构决策 > 临时方案
3. 文档规范 > 个人习惯

## 自动化文档维护

### 文档目录结构
```
docs/
├── design/          # 设计文档
├── decisions/       # 架构决策记录
│   └── adr/         # ADR 文档
├── prompts/         # 提示词模板
├── requirements/    # 需求文档
├── retros/          # 迭代回顾
├── sessions/        # 会话记录
├── changelog/       # 变更记录
└── index.md         # 文档索引
```

### 索引自动更新
- 每当在 `docs/` 下创建新文件，AI 必须主动更新文档索引
- 更新必须包含：文件路径、描述、创建日期
- 更新必须按照文件类型分类，保持索引结构清晰

### 模板驱动文档创建
- **ADR 文档**：基于 ADR 模板创建
- **Prompt 文档**：基于 Prompt 模板创建
- **会话记录**：基于会话记录模板创建
- **回顾文档**：基于回顾文档模板创建
- **变更记录**：基于变更记录模板创建
- **设计文档**：基于设计文档模板创建
- **需求文档**：基于需求文档模板创建

### 文档创建时机
- **前置文档**：任务开始前创建（需求文档、设计文档、Prompt 文档）
- **过程文档**：任务执行过程中创建（会话记录、ADR 文档）
- **后置文档**：任务完成后创建（变更记录、回顾文档）

### 文档创建流程
1. **模板选择**：根据文档类型选择对应的模板文件
2. **内容填充**：基于模板结构填充具体内容
3. **引用关联**：添加相关文档的引用链接
4. **Canvas 关联**：确保文档与 Canvas 文件中的相关节点关联
5. **索引更新**：更新文档索引
6. **实时维护**：实时更新文档内容，确保与实际进展同步

### 会话自动归档
- **任务开始时**：按会话记录模板创建会话记录框架
- **任务执行过程中**：实时更新会话记录内容
- **任务结束时**：完成会话记录的最终版本
- 会话记录必须包含：现状、目标、引用链接、关键决策、回滚步骤
- 提醒用户同步更新 Canvas 画布

### 变更自动记录
- **变更开始时**：基于变更记录模板创建变更记录框架
- **变更执行过程中**：实时更新变更记录内容
- **变更完成后**：完成变更记录的最终版本
- 所有重要变更必须在变更记录中记录
- 记录必须包含：变更内容、影响范围、实施人员、日期
- 变更记录必须按版本号和日期排序

### 文档一致性检查
- AI 必须定期检查文档的一致性，确保：
  - 所有文档都基于相应的模板创建
  - 文档内容与 Canvas 文件中的定义一致
  - 文档之间的引用关系正确
  - 索引文件与实际文件结构一致

## 操作指令集

### 关键词触发
- `/session` - 自动归档当前会话
- `/adr` - 启动架构决策记录起草
- `/prompt` - 创建或更新 Prompt 模板
- `/canvas` - 检查并提醒更新 Canvas 画布
- `/index` - 更新文档索引

### 指令执行逻辑
1. 用户输入触发指令
2. AI 识别指令类型和参数
3. 执行对应操作
4. 生成操作结果报告

## 违规处理

### 轻微违规
- 提醒用户并要求修正
- 记录在会话归档中

### 严重违规
- 拒绝执行操作
- 要求用户确认正确的流程
- 必要时请求人工干预

## 规则更新

### 更新流程
1. 提出规则变更建议
2. 创建 ADR 记录
3. 团队审核
4. 批准后更新规则文件
5. 通知所有团队成员

### 版本控制
- 规则文件必须通过 Git 进行版本控制
- 每次更新必须记录变更原因和影响

## 生效时间

本规则自创建之日起生效，适用于所有项目相关的 AI 操作。