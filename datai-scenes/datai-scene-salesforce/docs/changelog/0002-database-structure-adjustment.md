# 变更记录：数据库结构调整

## 变更信息

- **版本号**: v1.0.0
- **发布日期**: 2026-01-10
- **变更类型**: [特性更新]

## 变更摘要

本次变更主要涉及数据库结构的调整，包括在现有的对象表中增加is_realtime_sync字段用于控制实时同步状态，以及创建专门的实时同步日志表用于记录同步详情。这些数据库结构调整是支持Salesforce CDC实时同步功能的基础。

## 详细变更

### 特性更新

- **对象表结构扩展** - 在现有的对象表中增加`is_realtime_sync`字段（tinyint(1)类型），用于标识该对象是否开启实时数据同步
- **实时同步日志表创建** - 创建专门的`datai_integration_realtime_sync_log`表，用于记录对象数据同步的详细信息
- **表结构优化** - 优化相关表结构，确保数据存储和查询效率

## 影响范围

### 受影响的模块

- **数据库模块** - 新增和修改表结构
- **对象管理模块** - 扩展对象表结构
- **同步日志模块** - 新增实时同步日志表

### 兼容性说明

- **向后兼容** - 本次变更不影响现有的表结构和数据
- **字段兼容性** - 新增的is_realtime_sync字段默认值为0（未开启）

## 升级指南

### 升级步骤

1. **备份数据库** - 在进行数据库结构调整前，备份现有数据库
2. **执行SQL脚本** - 执行数据库结构调整的SQL脚本
3. **验证表结构** - 验证表结构是否正确调整
4. **更新应用配置** - 更新应用配置以使用新的表结构

### 注意事项

- **数据备份** - 确保在调整表结构前备份所有相关数据
- **执行顺序** - 按照指定的顺序执行SQL脚本
- **验证测试** - 确保调整后的表结构能够正常工作

## 测试信息

### 测试环境

- **开发环境** - 本地开发环境，使用测试数据库
- **测试环境** - 测试服务器，使用测试数据库

### 测试结果

- **表结构创建测试** - 成功创建实时同步日志表
- **字段添加测试** - 成功在对象表中添加is_realtime_sync字段
- **数据存储测试** - 成功存储同步配置和日志数据
- **查询性能测试** - 验证查询性能符合要求

## 相关链接

- [需求文档](../requirements/0001-salesforce-realtime-sync.md) - Salesforce数据及时同步至本地数据库
- [设计文档](../design/0001-salesforce-cdc-realtime-sync.md) - Salesforce CDC实时同步设计
- [架构决策](../decisions/adr/0001-salesforce-cdc-sync.md) - Salesforce CDC同步方案
- [实时同步日志表SQL](../sql/create-realtime-sync-log-table.sql) - 实时同步日志表创建SQL

## 发布人员

- **开发人员** - 系统管理员

## 审核信息

- **审核人员**: 系统管理员
- **审核日期**: 2026-01-10
- **审核状态**: [通过]
- **审核意见**: 数据库结构调整符合设计要求，is_realtime_sync字段类型为tinyint(1)，实时同步日志表结构合理，能够满足实时同步的需求。