# Salesforce数据集成模块 - 项目简报

## 文档信息
- **版本**: 1.0
- **更新时间**: 2026-01-07
- **来源**: datai-salesforce-integration/projectbrief.md
- **状态**: 已迁移

## 项目概述

本项目是Datai平台中的Salesforce数据集成模块，负责实现Salesforce与本地数据库之间的数据同步和集成功能。模块提供完整的元数据管理、数据拉取、批次管理、监控日志等核心能力。

## 核心功能需求

### 1. 元数据同步管理

#### 1.1 对象元数据同步
- **功能描述**：从Salesforce拉取对象元数据信息并同步到本地数据库
- **核心能力**：
  - 支持单个对象和批量对象的元数据同步
  - 自动识别对象属性（API名称、标签、权限等）
  - 区分标准对象和自定义对象
  - 支持元数据变更检测和记录

#### 1.2 字段元数据同步
- **功能描述**：同步Salesforce对象的字段详细信息
- **核心能力**：
  - 字段属性同步（类型、长度、精度、是否可空等）
  - 字段权限同步（创建、更新、删除权限）
  - 字段关系同步（引用字段、查找字段）
  - 选择列表值同步
  - 过滤查找信息同步

#### 1.3 元数据变更监控
- **功能描述**：监控Salesforce元数据的变更并记录到本地
- **核心能力**：
  - 实时检测字段新增、修改、删除
  - 记录变更历史
  - 支持全对象和单对象变更查询

### 2. 数据同步功能

#### 2.1 全量数据同步
- **功能描述**：首次同步或需要重新同步时，拉取对象的全部数据
- **核心能力**：
  - 基于批次的多线程并行拉取
  - 支持大数据量对象（>500万记录）的分区表处理
  - 自动批次划分和调度
  - 批次级别的错误处理和重试

#### 2.2 增量数据同步
- **功能描述**：基于时间戳的增量数据拉取
- **核心能力**：
  - 支持增量更新开关配置
  - 基于日期字段的时间范围查询
  - 自动累加记录数
  - 增量批次管理

#### 2.3 多对象同步
- **功能描述**：支持多个对象的批量同步
- **核心能力**：
  - 并行同步多个对象
  - 独立的对象状态管理
  - 统一的同步结果汇总

### 3. 批次管理

#### 3.1 批次配置
- **功能描述**：管理数据同步的批次配置
- **核心能力**：
  - 全量批次配置（FULL类型）
  - 增量批次配置（INCREMENTAL类型）
  - 批次字段配置
  - 批次时间范围配置

#### 3.2 批次执行
- **功能描述**：执行批次数据同步
- **核心能力**：
  - 批次级别的数据拉取
  - 批次状态跟踪
  - 批次历史记录
  - 批次错误处理

#### 3.3 批次监控
- **功能描述**：监控批次执行情况
- **核心能力**：
  - 批次进度查询
  - 批次统计信息
  - 批次失败原因记录

### 4. 连接管理

#### 4.1 多协议支持
- **功能描述**：支持多种Salesforce API协议
- **核心能力**：
  - REST API连接
  - SOAP API连接（Partner API）
  - Bulk API V1连接
  - Bulk API V2连接

#### 4.2 会话管理
- **功能描述**：管理Salesforce会话生命周期
- **核心能力**：
  - 会话缓存
  - 会话有效性检测
  - 自动重新登录
  - 会话过期处理

#### 4.3 连接池管理
- **功能描述**：使用工厂模式管理连接实例
- **核心能力**：
  - 连接实例缓存
  - 线程安全的连接获取
  - 连接清理机制
  - 配置化连接管理

### 5. 监控与日志

#### 5.1 API调用日志
- **功能描述**：记录所有Salesforce API调用
- **核心能力**：
  - API调用时间记录
  - API调用耗时统计
  - API调用结果记录
  - API调用失败原因记录

#### 5.2 同步日志
- **功能描述**：记录数据同步操作
- **核心能力**：
  - 同步操作类型记录（全量/增量）
  - 同步操作状态记录（成功/失败）
  - 同步执行时间记录
  - 同步错误信息记录

#### 5.3 限流管理
- **功能描述**：监控和管理Salesforce API限流
- **核心能力**：
  - API使用量统计
  - 限流阈值监控
  - 限流预警
  - 限流重置任务

#### 5.4 统计分析
- **功能描述**：提供多维度的统计分析
- **核心能力**：
  - 对象同步统计
  - 批次执行统计
  - API使用趋势
  - 性能指标分析

### 6. 对象管理

#### 6.1 对象配置
- **功能描述**：管理Salesforce对象的同步配置
- **核心能力**：
  - 对象启用/禁用同步
  - 对象增量更新开关
  - 对象排序权重配置
  - 对象分区配置

#### 6.2 对象依赖关系
- **功能描述**：分析对象之间的依赖关系
- **核心能力**：
  - 引用字段识别
  - 依赖关系图生成
  - 同步顺序建议

#### 6.3 对象表结构创建
- **功能描述**：根据对象元数据创建本地表结构
- **核心能力**：
  - 自动生成DDL语句
  - 支持分区表创建
  - 字段类型映射
  - 索引创建

### 7. 定时任务

#### 7.1 同步任务
- **功能描述**：定时执行数据同步
- **核心能力**：
  - 可配置的同步频率
  - 支持单对象和多对象同步
  - 任务执行状态监控

#### 7.2 限流重置任务
- **功能描述**：定时重置限流统计
- **核心能力**：
  - 按日重置API使用量
  - 自动清理过期数据

### 8. 数据转换

#### 8.1 类型转换
- **功能描述**：Salesforce数据类型到本地数据类型的转换
- **核心能力**：
  - 基本类型转换
  - 日期时间转换
  - 枚举类型转换
  - 复杂类型处理

#### 8.2 数据清洗
- **功能描述**：数据质量保证
- **核心能力**：
  - 空值处理
  - 格式标准化
  - 数据验证

### 9. 异常处理

#### 9.1 错误捕获
- **功能描述**：全面的错误捕获机制
- **核心能力**：
  - 连接异常处理
  - 数据拉取异常处理
  - 批次执行异常处理

#### 9.2 错误恢复
- **功能描述**：自动和手动的错误恢复
- **核心能力**：
  - 自动重试机制
  - 失败批次重试
  - 错误信息记录

#### 9.3 错误通知
- **功能描述**：错误信息通知
- **核心能力**：
  - 错误日志记录
  - 错误状态更新
  - 错误信息展示

### 10. 安全与权限

#### 10.1 接口权限控制
- **功能描述**：基于Spring Security的接口权限控制
- **核心能力**：
  - 细粒度的权限配置
  - 操作日志记录

#### 10.2 数据权限控制
- **功能描述**：基于部门的数据隔离
- **核心能力**：
  - 部门级数据隔离
  - 数据访问控制

## 技术特性

### 性能优化
- 多线程并行数据拉取
- 连接池管理
- 批次级别的并发控制
- 大数据量分区表支持

### 可靠性保障
- 会话自动重连
- 批次级别的错误隔离
- 事务管理
- 数据一致性保证

### 可扩展性
- 工厂模式支持多种API协议
- 模块化设计
- 配置化管理
- 插件式扩展

### 可维护性
- 完善的日志记录
- 详细的错误信息
- 统一的异常处理
- 清晰的代码结构

## 应用场景

1. **数据仓库**：将Salesforce数据同步到本地数据仓库进行分析
2. **数据备份**：定期备份Salesforce数据到本地数据库
3. **数据集成**：与本地系统集成，实现数据互通
4. **数据分析**：基于本地数据进行复杂分析和报表
5. **数据迁移**：Salesforce数据迁移到其他系统

## 项目价值

- **数据自主性**：将Salesforce数据掌握在自己手中
- **性能提升**：本地查询性能远超远程API调用
- **成本降低**：减少API调用次数，降低Salesforce API成本
- **灵活性增强**：基于本地数据进行灵活的数据处理和分析
- **可靠性保障**：避免网络问题导致的数据访问失败