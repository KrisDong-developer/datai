# 接口文档

## 接口信息

- **接口名称**: 删除配置环境
- **接口路径**: /setting/environment/{ids}
- **请求方法**: DELETE
- **模块归属**: datai-salesforce-setting
- **版本号**: v1.0
- **创建日期**: 2026-01-14
- **最后更新**: 2026-01-14

## 功能描述

根据环境ID删除配置环境记录，支持批量删除。通常此接口用于清理不再使用的环境配置数据。删除环境后，该环境将无法再被切换使用。

## 请求参数

### 路径参数

| 参数名 | 类型 | 必填 | 描述 | 示例 |
|--------|------|------|------|------|
| ids | Long[] | 是 | 环境ID数组，多个ID用逗号分隔 | 1,2,3 |

## 响应数据

### 成功响应

**HTTP 状态码**: 200 OK

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": 3
}
```

| 字段名 | 类型 | 描述 | 示例 |
|--------|------|------|------|
| code | Integer | 响应码 | 200 |
| msg | String | 响应消息 | 操作成功 |
| data | Integer | 影响的行数（删除成功的记录数） | 3 |

### 失败响应

**HTTP 状态码**: 400/401/403/500

```json
{
  "code": 401,
  "msg": "您没有权限执行此操作",
  "data": null
}
```

| 错误码 | 错误信息 | 描述 |
|--------|----------|------|
| 400 | 参数错误 | 参数验证失败 |
| 401 | 您没有权限执行此操作 | 权限不足 |
| 403 | 访问被拒绝 | 访问被拒绝 |
| 500 | 系统错误 | 系统内部错误 |

## 接口示例

### 请求示例

```bash
curl -X DELETE "http://localhost:8080/setting/environment/1,2,3" \
  -H "Authorization: Bearer [token]"
```

### 响应示例

**成功**:

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": 3
}
```

**失败**:

```json
{
  "code": 401,
  "msg": "您没有权限执行此操作",
  "data": null
}
```

## 错误处理

1. **权限验证失败**: 检查用户是否具有 setting:environment:remove 权限
2. **参数验证失败**: 检查环境ID是否有效
3. **系统错误**: 记录错误日志并返回通用错误信息

## 注意事项

1. 接口需要登录认证，需要携带有效的 token
2. 接口需要 setting:environment:remove 权限
3. 支持批量删除，多个ID用逗号分隔
4. 删除操作不可恢复，请谨慎操作
5. 删除操作会记录到操作日志中
6. 如果删除的环境是当前激活的环境，删除后需要重新切换环境
7. 删除环境可能会影响环境切换功能，请谨慎操作
8. 建议在删除前先查询确认要删除的环境记录
9. 删除不存在的环境ID不会报错，返回的data值表示实际删除的记录数

## 相关接口

- [查询配置环境列表](0001-environment-list.md) - 查询配置环境列表
- [获取配置环境详细信息](0003-get-info.md) - 获取单个环境的详细信息
- [新增配置环境](0004-add-environment.md) - 新增配置环境
- [修改配置环境](0005-edit-environment.md) - 修改配置环境

## 实现细节

1. 接收环境ID路径参数，支持多个ID用逗号分隔
2. 调用 IDataiConfigEnvironmentService 删除环境记录
3. 返回操作结果

## 测试信息

### 测试环境

- **环境**: 本地开发环境
- **版本**: v1.0

### 测试用例

| 测试场景 | 输入参数 | 预期结果 | 实际结果 | 状态 |
|----------|----------|----------|----------|------|
| 删除单条环境 | ids=1 | 返回成功，data=1 | 返回成功，data=1 | 通过 |
| 删除多条环境 | ids=1,2,3 | 返回成功，data=3 | 返回成功，data=3 | 通过 |
| 删除不存在的环境 | ids=9999 | 返回成功，data=0 | 返回成功，data=0 | 通过 |
| 无效ID格式 | ids=abc | 返回参数错误 | 返回参数错误 | 通过 |
| 无权限访问 | 无权限token | 返回401错误 | 返回401错误 | 通过 |
