# Salesforce配置管理模块说明文档

## 1. 模块概述

Salesforce配置管理模块是一个用于管理Salesforce相关配置的核心模块，提供配置的加载、缓存、更新、版本管理和回滚等功能。该模块采用分布式架构设计，支持多环境配置隔离，确保配置的安全性和可靠性。

## 2. 功能特性

### 2.1 配置加载流程
- 系统启动时自动加载配置到缓存
- 支持按环境（开发/测试/生产）加载差异化配置
- 配置完整性验证和合法性校验
- 详细的配置加载日志记录

### 2.2 配置更新流程
- 配置更新API接口
- 配置值合法性验证
- Redis缓存优先更新策略
- 配置版本号自动递增
- 配置变更事件发布
- 审计日志记录

### 2.3 配置版本管理
- 配置快照生成
- 版本状态管理（已创建、已发布）
- 版本发布功能
- 版本回滚功能

### 2.4 配置回滚流程
- 回滚API接口
- 回滚权限验证和版本合法性校验
- 历史快照恢复
- 缓存与数据库双更新

### 2.5 配置审计日志
- 覆盖所有配置操作
- 记录操作人、时间、IP地址等信息
- 支持按条件查询
- 支持日志导出

## 3. 技术架构

### 3.1 整体架构
- 采用Spring Boot框架开发
- 基于RESTful API设计
- 支持Redis缓存
- 数据库采用MySQL
- 支持多租户隔离

### 3.2 核心组件
- 配置加载服务：负责系统启动时配置初始化
- 配置缓存管理器：管理配置缓存
- 配置版本服务：处理配置版本管理
- 配置变更事件：实现配置动态生效
- 审计日志服务：记录配置操作日志

### 3.3 数据存储
- 配置表：存储实际的配置键值对
- 配置版本表：存储配置版本信息
- 配置环境表：存储环境信息
- 配置审计日志表：存储审计日志
- 配置快照表：存储配置快照

## 4. 模块结构

```
├── controller/          # 控制器层
│   ├── DataiConfigurationController.java       # 配置管理控制器
│   ├── DataiConfigVersionController.java       # 配置版本控制器
│   ├── DataiConfigAuditLogController.java      # 审计日志控制器
│   ├── DataiConfigEnvironmentController.java   # 环境管理控制器
│   └── DataiConfigSnapshotController.java      # 快照管理控制器
├── domain/             # 实体层
│   ├── DataiConfiguration.java                # 配置实体
│   ├── DataiConfigVersion.java                # 版本实体
│   ├── DataiConfigAuditLog.java               # 审计日志实体
│   ├── DataiConfigEnvironment.java            # 环境实体
│   └── DataiConfigSnapshot.java               # 快照实体
├── mapper/             # 数据访问层
│   ├── DataiConfigurationMapper.java          # 配置Mapper
│   ├── DataiConfigVersionMapper.java          # 版本Mapper
│   ├── DataiConfigAuditLogMapper.java         # 审计日志Mapper
│   ├── DataiConfigEnvironmentMapper.java      # 环境Mapper
│   └── DataiConfigSnapshotMapper.java         # 快照Mapper
├── service/            # 服务层
│   ├── IDataiConfigurationService.java        # 配置服务接口
│   ├── IDataiConfigVersionService.java        # 版本服务接口
│   ├── IDataiConfigAuditLogService.java       # 审计日志服务接口
│   ├── IDataiConfigEnvironmentService.java    # 环境服务接口
│   ├── IDataiConfigSnapshotService.java       # 快照服务接口
│   └── impl/           # 服务实现
├── config/             # 配置类
│   └── SalesforceConfigCacheManager.java      # 配置缓存管理器
└── event/              # 事件相关
    ├── ConfigChangeEvent.java                # 配置变更事件
    └── ConfigChangeListener.java             # 事件监听器
```

## 5. 核心API接口

### 5.1 配置管理接口
- 查询配置列表：`GET /setting/configuration/list`
- 新增配置：`POST /setting/configuration`
- 修改配置：`PUT /setting/configuration`
- 删除配置：`DELETE /setting/configuration/{configIds}`
- 刷新配置缓存：`POST /setting/configuration/refresh`
- 验证配置值：`POST /setting/configuration/validate`

### 5.2 配置版本接口
- 查询版本列表：`GET /setting/version/list`
- 创建快照：`POST /setting/version/snapshot`
- 发布版本：`POST /setting/version/{versionId}/publish`
- 回滚版本：`POST /setting/version/{versionId}/rollback`

## 6. 部署说明

### 6.1 环境要求
- JDK 11+
- Spring Boot 3.5.7
- MySQL 8.0+
- Redis 6.0+

### 6.2 部署流程
1. 执行数据库初始化脚本：`salesforce-config-tables.sql`
2. 配置数据库连接信息
3. 配置Redis连接信息
4. 启动应用服务

## 7. 监控与维护

### 7.1 日志管理
- 配置加载日志：记录配置加载过程
- 操作审计日志：记录所有配置操作
- 错误日志：记录系统异常信息

### 7.2 常见问题
- 配置加载失败：检查数据库连接和配置表结构
- 缓存不同步：调用刷新缓存接口
- 版本回滚失败：检查版本合法性和权限

## 8. 开发规范

### 8.1 代码规范
- 遵循Java编码规范
- 使用Spring Boot最佳实践
- 接口设计遵循RESTful风格
- 代码注释完整

### 8.2 安全规范
- 敏感配置加密存储
- 接口访问权限控制
- 操作审计日志记录
- 输入参数验证

## 9. 未来规划

- 支持配置导入导出功能
- 增强配置验证规则
- 支持配置变更通知到外部系统
- 提供配置可视化管理界面
- 支持配置灰度发布

## 10. 联系方式

- 维护团队：Datai开发团队
- 联系邮箱：dev@datai.com
- 文档更新时间：2025-12-14