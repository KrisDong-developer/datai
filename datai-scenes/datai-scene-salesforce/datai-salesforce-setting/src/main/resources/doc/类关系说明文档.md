# Salesforce配置管理模块 - 类关系说明文档

## 1. 文档概述

本文档详细说明 `datai-salesforce-setting` 模块中 `domain` 目录下所有实体类之间的关系，包括实体关系图（ER图）、UML类图、时序图以及详细的关联关系说明。这些关系构成了配置管理系统的核心数据模型，支撑着配置的存储、版本控制、审计和多环境管理等功能。

## 2. 实体类总览

| 实体类名称 | 对应数据表 | 核心作用 | 关键特性 |
|-----------|-----------|---------|---------|
| DataiConfiguration | datai_configuration | 配置存储实体 | 支持多环境、敏感配置、加密存储 |
| DataiConfigEnvironment | datai_config_environment | 环境管理实体 | 环境隔离、激活状态管理 |
| DataiConfigVersion | datai_config_version | 版本管理实体 | 版本控制、快照关联、状态管理 |
| DataiConfigSnapshot | datai_config_snapshot | 快照存储实体 | 时间点快照、配置备份 |
| DataiConfigAuditLog | datai_config_audit_log | 审计日志实体 | 操作追踪、变更记录、安全审计 |

## 3. 实体关系图（ER图）

### 3.1 整体ER关系图

```
┌─────────────────────────────────────────────────────────────────────┐
│                        datai_config_environment                     │
│                        (配置环境表)                                 │
├─────────────────────────────────────────────────────────────────────┤
│ PK id (环境ID)                                                      │
│    deptId (部门ID)                                                  │
│    environmentName (环境名称)                                       │
│    environmentCode (环境编码)                                       │
│    description (环境描述)                                           │
│    isActive (是否激活)                                              │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ 1
                                    │
                                    │ N
                                    │
┌─────────────────────────────────────────────────────────────────────┐
│                        datai_configuration                          │
│                        (配置表)                                      │
├─────────────────────────────────────────────────────────────────────┤
│ PK id (配置ID)                                                       │
│    deptId (部门ID)                                                  │
│    configKey (配置键)                                               │
│    configValue (配置值)                                             │
│ FK environmentId (环境ID) ─────────────────────────────────────┐     │
│    isSensitive (是否敏感配置)                                   │     │
│    isEncrypted (是否加密存储)                                   │     │
│    description (配置描述)                                       │     │
│    isActive (是否激活)                                          │     │
│    version (配置版本号)                                         │     │
└─────────────────────────────────────────────────────────────────────┘     │
          │                                                                   │
          │ N                                                                 │
          │                                                                   │
          │ 1                                                                 │
          │                                                                   │
          │                                                                   │
┌─────────────────────────────────────────────────────────────────────┐     │
│                        datai_config_audit_log                       │     │
│                        (审计日志表)                                  │     │
├─────────────────────────────────────────────────────────────────────┤     │
│ PK id (日志ID)                                                       │     │
│    deptId (部门ID)                                                  │     │
│    operationType (操作类型)                                         │     │
│    objectType (对象类型)                                            │     │
│ FK objectId (对象ID) ────────────────────────────────────────────────┘     │
│    oldValue (旧值)                                                   │
│    newValue (新值)                                                   │
│    operationDesc (操作描述)                                          │
│    operator (操作人)                                                 │
│    operationTime (操作时间)                                          │
│    ipAddress (IP地址)                                                │
│    userAgent (用户代理)                                              │
│    requestId (请求ID)                                                │
│    result (操作结果)                                                 │
│    errorMessage (错误信息)                                           │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                        datai_config_version                         │
│                        (配置版本表)                                  │
├─────────────────────────────────────────────────────────────────────┤
│ PK id (版本ID)                                                       │
│    deptId (部门ID)                                                  │
│    versionNumber (版本号)                                           │
│    versionDesc (版本描述)                                           │
│ FK snapshotId (快照ID) ─────────────────────────────────────────┐   │
│    snapshotContent (快照内容)                                    │   │
│    status (版本状态)                                             │   │
│    publishTime (发布时间)                                        │   │
└─────────────────────────────────────────────────────────────────────┘   │
          │                                                                 │
          │ N                                                               │
          │                                                                 │
          │ 1                                                               │
          │                                                                 │
          │                                                                 │
┌─────────────────────────────────────────────────────────────────────┐   │
│                        datai_config_snapshot                        │   │
│                        (配置快照表)                                  │   │
├─────────────────────────────────────────────────────────────────────┤
│ PK id (快照ID)                                                       │   │
│    deptId (部门ID)                                                  │   │
│ FK versionId (版本ID) ──────────────────────────────────────────────┘   │
│    snapshotTime (快照时间)                                              │
│    snapshotContent (快照内容)                                           │
│    configCount (配置数量)                                              │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 关联关系说明

| 关联关系 | 源实体 | 目标实体 | 关联字段 | 关系类型 | 级联规则 |
|---------|-------|---------|---------|---------|---------|
| 配置-环境 | DataiConfiguration | DataiConfigEnvironment | environmentId → id | N:1 | 删除环境需检查配置 |
| 审计日志-配置 | DataiConfigAuditLog | DataiConfiguration | objectId → id | N:1 | 删除配置保留日志 |
| 审计日志-版本 | DataiConfigAuditLog | DataiConfigVersion | objectId → id | N:1 | 删除版本保留日志 |
| 版本-快照 | DataiConfigVersion | DataiConfigSnapshot | snapshotId → id | 1:1 | 删除版本级联快照 |
| 快照-版本 | DataiConfigSnapshot | DataiConfigVersion | versionId → id | N:1 | 删除版本级联快照 |

## 4. UML类图

### 4.1 实体层UML类图

```
┌────────────────────────────────────────────────────────────────────────┐
│                        BaseEntity                                      │
│                        (基础实体类)                                    │
├────────────────────────────────────────────────────────────────────────┤
│ # remark: String                                                       │
│ # createBy: String                                                     │
│ # createTime: LocalDateTime                                           │
│ # updateBy: String                                                     │
│ # updateTime: LocalDateTime                                           │
├────────────────────────────────────────────────────────────────────────┤
│ + getRemark(): String                                                  │
│ + setRemark(String): void                                             │
│ + getCreateBy(): String                                                │
│ + setCreateBy(String): void                                           │
│ + getCreateTime(): LocalDateTime                                       │
│ + setCreateTime(LocalDateTime): void                                  │
│ + getUpdateBy(): String                                                │
│ + setUpdateBy(String): void                                           │
│ + getUpdateTime(): LocalDateTime                                       │
│ + setUpdateTime(LocalDateTime): void                                  │
└────────────────────────────────────────────────────────────────────────┘
                                  △
                                  │ extends
                                  │
        ┌─────────────────────────┼─────────────────────────┐
        │                         │                         │
┌───────────────────────┐  ┌───────────────────────┐  ┌───────────────────────┐
│ DataiConfigEnvironment│  │ DataiConfiguration   │  │ DataiConfigVersion   │
│ (配置环境实体)         │  │ (配置实体)            │  │ (配置版本实体)         │
├───────────────────────┤  ├───────────────────────┤  ├───────────────────────┤
│ - id: Long            │  │ - id: Long            │  │ - id: Long            │
│ - deptId: Long        │  │ - deptId: Long        │  │ - deptId: Long        │
│ - environmentName:    │  │ - configKey: String   │  │ - versionNumber:      │
│   String              │  │ - configValue: String │  │   String              │
│ - environmentCode:    │  │ - environmentId: Long │  │ - versionDesc: String │
│   String              │  │ - isSensitive:       │  │ - snapshotId: String  │
│ - description: String │  │   Boolean             │  │ - snapshotContent:    │
│ - isActive: Boolean   │  │ - isEncrypted:       │  │   String              │
├───────────────────────┤  │   Boolean             │  │ - status: String      │
│ + getId(): Long       │  │ - description: String │  │ - publishTime:        │
│ + setId(Long): void   │  │ - isActive: Boolean   │  │   LocalDateTime       │
│ + getDeptId(): Long   │  │ - version: Integer    │  ├───────────────────────┤
│ + setDeptId(Long):    │  ├───────────────────────┤  │ + getId(): Long       │
│   void                │  │ + getId(): Long       │  │ + setId(Long): void   │
│ + getEnvironmentName()│  │ + setId(Long): void   │  │ + getDeptId(): Long   │
│   : String            │  │ + getDeptId(): Long   │  │ + setDeptId(Long):    │
│ + setEnvironmentName(│  │ + setDeptId(Long):    │  │   void                │
│   String): void       │  │   void                │  │ + getVersionNumber()  │
│ + getEnvironmentCode()│  │ + getConfigKey():     │  │   : String            │
│   : String            │  │   String              │  │ + setVersionNumber(   │
│ + setEnvironmentCode(│  │ + setConfigKey(        │  │   String): void       │
│   String): void       │  │   String): void       │  │ + getVersionDesc():   │
│ + getDescription():   │  │ + getConfigValue():   │  │   String              │
│   String              │  │   String              │  │ + setVersionDesc(     │
│ + setDescription(     │  │ + setConfigValue(     │  │   String): void       │
│   String): void       │  │   String): void       │  │ + getSnapshotId():    │
│ + getIsActive():      │  │ + getEnvironmentId(): │  │   String              │
│   Boolean             │  │   Long                │  │ + setSnapshotId(     │
│ + setIsActive(        │  │ + setEnvironmentId(   │  │   String): void       │
│   Boolean): void      │  │   Long): void          │  │ + getSnapshotContent()│
└───────────────────────┘  │ + getIsSensitive():   │  │   : String            │
                            │   Boolean             │  │ + setSnapshotContent(│
                            │ + setIsSensitive(     │  │   String): void       │
                            │   Boolean): void      │  │ + getStatus(): String │
                            │ + getIsEncrypted():   │  │ + setStatus(String):  │
                            │   Boolean             │  │   void                │
                            │ + setIsEncrypted(     │  │ + getPublishTime():   │
                            │   Boolean): void      │  │   LocalDateTime       │
                            │ + getDescription():   │  │ + setPublishTime(    │
                            │   String              │  │   LocalDateTime):    │
                            │ + setDescription(     │  │   void                │
                            │   String): void       │  └───────────────────────┘
                            │ + getIsActive():      │
                            │   Boolean             │
                            │ + setIsActive(        │
                            │   Boolean): void      │
                            │ + getVersion():       │
                            │   Integer             │
                            │ + setVersion(         │
                            │   Integer): void      │
                            └───────────────────────┘
        ┌─────────────────────────┼─────────────────────────┐
        │                         │                         │
┌───────────────────────┐  ┌───────────────────────┐  ┌───────────────────────┐
│ DataiConfigSnapshot   │  │ DataiConfigAuditLog   │                          │
│ (配置快照实体)         │  │ (审计日志实体)         │                          │
├───────────────────────┤  ├───────────────────────┤                          │
│ - id: String          │  │ - id: Long            │                          │
│ - deptId: Long        │  │ - deptId: Long        │                          │
│ - versionId: Long     │  │ - operationType:      │                          │
│ - snapshotTime:       │  │   String              │                          │
│   LocalDateTime       │  │ - objectType: String  │                          │
│ - snapshotContent:    │  │ - objectId: Long      │                          │
│   String              │  │ - oldValue: String    │                          │
│ - configCount:        │  │ - newValue: String    │                          │
│   Integer             │  │ - operationDesc:      │                          │
├───────────────────────┤  │   String              │                          │
│ + getId(): String     │  │ - operator: String    │                          │
│ + setId(String): void │  │ - operationTime:      │                          │
│ + getDeptId(): Long   │  │   LocalDateTime       │                          │
│ + setDeptId(Long):    │  │ - ipAddress: String   │                          │
│   void                │  │ - userAgent: String   │                          │
│ + getVersionId():     │  │ - requestId: String   │                          │
│   Long                │  │ - result: String      │                          │
│ + setVersionId(Long): │  │ - errorMessage: String │                          │
│   void                │  ├───────────────────────┤                          │
│ + getSnapshotTime():  │  │ + getId(): Long       │                          │
│   LocalDateTime       │  │ + setId(Long): void   │                          │
│ + setSnapshotTime(    │  │ + getDeptId(): Long   │                          │
│   LocalDateTime):     │  │ + setDeptId(Long):    │                          │
│   void                │  │   void                │                          │
│ + getSnapshotContent()│  │ + getOperationType(): │                          │
│   : String            │  │   String              │                          │
│ + setSnapshotContent( │  │ + setOperationType(   │                          │
│   String): void       │  │   String): void       │                          │
│ + getConfigCount():   │  │ + getObjectType():    │                          │
│   Integer             │  │   String              │                          │
│ + setConfigCount(     │  │ + setObjectType(      │                          │
│   Integer): void      │  │   String): void       │                          │
└───────────────────────┘  │ + getObjectId(): Long  │
                            │ + setObjectId(Long):  │
                            │   void                │
                            │ + getOldValue():      │
                            │   String              │
                            │ + setOldValue(        │
                            │   String): void       │
                            │ + getNewValue():      │
                            │   String              │
                            │ + setNewValue(        │
                            │   String): void       │
                            │ + getOperationDesc(): │
                            │   String              │
                            │ + setOperationDesc(   │
                            │   String): void       │
                            │ + getOperator():      │
                            │   String              │
                            │ + setOperator(        │
                            │   String): void       │
                            │ + getOperationTime(): │
                            │   LocalDateTime       │
                            │ + setOperationTime(   │
                            │   LocalDateTime):     │
                            │   void                │
                            │ + getIpAddress():     │
                            │   String              │
                            │ + setIpAddress(       │
                            │   String): void       │
                            │ + getUserAgent():     │
                            │   String              │
                            │ + setUserAgent(       │
                            │   String): void       │
                            │ + getRequestId():     │
                            │   String              │
                            │ + setRequestId(       │
                            │   String): void       │
                            │ + getResult(): String │
                            │ + setResult(String):  │
                            │   void                │
                            │ + getErrorMessage():   │
                            │   String              │
                            │ + setErrorMessage(    │
                            │   String): void       │
                            └───────────────────────┘
```

### 4.2 类关系说明

**继承关系**：
- 所有实体类都继承自 `BaseEntity` 基类
- `BaseEntity` 提供了通用的审计字段（创建人、创建时间、更新人、更新时间、备注）

**关联关系**：
- `DataiConfiguration` 通过 `environmentId` 字段关联到 `DataiConfigEnvironment`
- `DataiConfigVersion` 通过 `snapshotId` 字段关联到 `DataiConfigSnapshot`
- `DataiConfigSnapshot` 通过 `versionId` 字段关联到 `DataiConfigVersion`
- `DataiConfigAuditLog` 通过 `objectId` 字段可以关联到 `DataiConfiguration` 或 `DataiConfigVersion`

## 5. 时序图

### 5.1 配置加载时序图

```
┌──────────┐    ┌───────────────┐    ┌──────────────────┐    ┌─────────────┐
│  Client  │    │ Configuration │    │   Environment    │    │    Cache    │
│          │    │   Controller  │    │     Service      │    │   Manager   │
└────┬─────┘    └───────┬───────┘    └────────┬─────────┘    └──────┬──────┘
     │                  │                      │                     │
     │  1. 加载配置请求  │                      │                     │
     ├─────────────────>│                      │                     │
     │                  │                      │                     │
     │                  │  2. 查询激活环境      │                     │
     │                  ├─────────────────────>│                     │
     │                  │                      │                     │
     │                  │  3. 返回环境信息      │                     │
     │                  │<─────────────────────┤                     │
     │                  │                      │                     │
     │                  │  4. 查询配置数据      │                     │
     │                  ├─────────────────────>│                     │
     │                  │                      │                     │
     │                  │                      │  5. 查询数据库       │
     │                  │                      ├───────────────────>│
     │                  │                      │                     │
     │                  │                      │  6. 返回配置数据     │
     │                  │                      │<───────────────────┤
     │                  │                      │                     │
     │                  │  7. 返回配置数据      │                     │
     │                  │<─────────────────────┤                     │
     │                  │                      │                     │
     │                  │  8. 存入缓存         │                     │
     │                  ├─────────────────────>│                     │
     │                  │                      │                     │
     │  9. 返回配置数据  │                      │                     │
     │<─────────────────┤                      │                     │
     │                  │                      │                     │
```

### 5.2 配置更新时序图

```
┌──────────┐    ┌───────────────┐    ┌──────────────────┐    ┌─────────────┐    ┌──────────────┐
│  Client  │    │ Configuration │    │   Configuration  │    │    Cache    │    │  AuditLog    │
│          │    │   Controller  │    │     Service      │    │   Manager   │    │   Service    │
└────┬─────┘    └───────┬───────┘    └────────┬─────────┘    └──────┬──────┘    └──────┬───────┘
     │                  │                      │                     │                   │
     │  1. 更新配置请求  │                      │                     │                   │
     ├─────────────────>│                      │                     │                   │
     │                  │                      │                     │                   │
     │                  │  2. 验证配置合法性    │                     │                   │
     │                  ├─────────────────────>│                     │                   │
     │                  │                      │                     │                   │
     │                  │  3. 返回验证结果      │                     │                   │
     │                  │<─────────────────────┤                     │                   │
     │                  │                      │                     │                   │
     │                  │  4. 更新数据库配置    │                     │                   │
     │                  ├─────────────────────>│                     │                   │
     │                  │                      │                     │                   │
     │                  │  5. 返回更新结果      │                     │                   │
     │                  │<─────────────────────┤                     │                   │
     │                  │                      │                     │                   │
     │                  │  6. 更新缓存         │                     │                   │
     │                  ├──────────────────────────────────────────>│                   │
     │                  │                      │                     │                   │
     │                  │  7. 记录审计日志      │                     │                   │
     │                  ├──────────────────────────────────────────────────────────────>│
     │                  │                      │                     │                   │
     │                  │  8. 返回日志记录结果  │                     │                   │
     │                  │<──────────────────────────────────────────────────────────────┤
     │                  │                      │                     │                   │
     │  9. 返回更新结果  │                      │                     │                   │
     │<─────────────────┤                      │                     │                   │
     │                  │                      │                     │                   │
```

### 5.3 版本发布时序图

```
┌──────────┐    ┌───────────────┐    ┌──────────────────┐    ┌─────────────┐    ┌──────────────┐
│  Client  │    │   Version     │    │     Version      │    │    Cache    │    │  AuditLog    │
│          │    │   Controller  │    │     Service      │    │   Manager   │    │   Service    │
└────┬─────┘    └───────┬───────┘    └────────┬─────────┘    └──────┬──────┘    └──────┬───────┘
     │                  │                      │                     │                   │
     │  1. 发布版本请求  │                      │                     │                   │
     ├─────────────────>│                      │                     │                   │
     │                  │                      │                     │                   │
     │                  │  2. 创建配置快照      │                     │                   │
     │                  ├─────────────────────>│                     │                   │
     │                  │                      │                     │                   │
     │                  │  3. 生成快照数据      │                     │                   │
     │                  ├─────────────────────>│                     │                   │
     │                  │                      │                     │                   │
     │                  │  4. 返回快照数据      │                     │                   │
     │                  │<─────────────────────┤                     │                   │
     │                  │                      │                     │                   │
     │                  │  5. 创建版本记录      │                     │                   │
     │                  ├─────────────────────>│                     │                   │
     │                  │                      │                     │                   │
     │                  │  6. 返回版本信息      │                     │                   │
     │                  │<─────────────────────┤                     │                   │
     │                  │                      │                     │                   │
     │                  │  7. 记录审计日志      │                     │                   │
     │                  ├──────────────────────────────────────────────────────────────>│
     │                  │                      │                     │                   │
     │                  │  8. 刷新配置缓存      │                     │                   │
     │                  ├──────────────────────────────────────────>│                   │
     │                  │                      │                     │                   │
     │  9. 返回发布结果  │                      │                     │                   │
     │<─────────────────┤                      │                     │                   │
     │                  │                      │                     │                   │
```

### 5.4 版本回滚时序图

```
┌──────────┐    ┌───────────────┐    ┌──────────────────┐    ┌─────────────┐    ┌──────────────┐
│  Client  │    │   Version     │    │     Version      │    │    Cache    │    │  AuditLog    │
│          │    │   Controller  │    │     Service      │    │   Manager   │    │   Service    │
└────┬─────┘    └───────┬───────┘    └────────┬─────────┘    └──────┬──────┘    └──────┬───────┘
     │                  │                      │                     │                   │
     │  1. 回滚版本请求  │                      │                     │                   │
     ├─────────────────>│                      │                     │                   │
     │                  │                      │                     │                   │
     │                  │  2. 查询目标版本      │                     │                   │
     │                  ├─────────────────────>│                     │                   │
     │                  │                      │                     │                   │
     │                  │  3. 返回版本信息      │                     │                   │
     │                  │<─────────────────────┤                     │                   │
     │                  │                      │                     │                   │
     │                  │  4. 验证版本合法性    │                     │                   │
     │                  ├─────────────────────>│                     │                   │
     │                  │                      │                     │                   │
     │                  │  5. 返回验证结果      │                     │                   │
     │                  │<─────────────────────┤                     │                   │
     │                  │                      │                     │                   │
     │                  │  6. 从快照恢复配置    │                     │                   │
     │                  ├─────────────────────>│                     │                   │
     │                  │                      │                     │                   │
     │                  │  7. 返回恢复结果      │                     │                   │
     │                  │<─────────────────────┤                     │                   │
     │                  │                      │                     │                   │
     │                  │  8. 刷新配置缓存      │                     │                   │
     │                  ├──────────────────────────────────────────>│                   │
     │                  │                      │                     │                   │
     │                  │  9. 记录审计日志      │                     │                   │
     │                  ├──────────────────────────────────────────────────────────────>│
     │                  │                      │                     │                   │
     │ 10. 返回回滚结果  │                      │                     │                   │
     │<─────────────────┤                      │                     │                   │
     │                  │                      │                     │                   │
```

## 6. 详细关联关系说明

### 6.1 DataiConfiguration 与 DataiConfigEnvironment

**关系类型**：多对一（N:1）

**关联字段**：
- `DataiConfiguration.environmentId` → `DataiConfigEnvironment.id`

**业务含义**：
- 一个配置项属于一个环境
- 一个环境包含多个配置项
- 不同环境的配置相互隔离

**级联规则**：
- 删除环境时需要检查是否有关联的配置项
- 如果环境有关联的配置项，则不允许删除或需要级联处理

**使用场景**：
```java
// 查询特定环境的所有配置
List<DataiConfiguration> configs = configurationService.selectByEnvironmentId(environmentId);

// 查询配置所属的环境
DataiConfiguration config = configurationService.selectById(configId);
DataiConfigEnvironment env = environmentService.selectById(config.getEnvironmentId());
```

### 6.2 DataiConfigVersion 与 DataiConfigSnapshot

**关系类型**：一对一（1:1）

**关联字段**：
- `DataiConfigVersion.snapshotId` → `DataiConfigSnapshot.id`
- `DataiConfigSnapshot.versionId` → `DataiConfigVersion.id`

**业务含义**：
- 一个版本对应一个快照
- 一个快照属于一个版本
- 快照记录了版本发布时的配置状态

**级联规则**：
- 删除版本时级联删除对应的快照
- 删除快照时需要检查是否有关联的版本

**使用场景**：
```java
// 创建版本时关联快照
DataiConfigVersion version = new DataiConfigVersion();
version.setSnapshotId(snapshotId);

// 查询版本对应的快照
DataiConfigVersion version = versionService.selectById(versionId);
DataiConfigSnapshot snapshot = snapshotService.selectById(version.getSnapshotId());
```

### 6.3 DataiConfigAuditLog 与 DataiConfiguration

**关系类型**：多对一（N:1）

**关联字段**：
- `DataiConfigAuditLog.objectId` → `DataiConfiguration.id`（当 objectType = "配置" 时）

**业务含义**：
- 一条审计日志记录对一个配置的操作
- 一个配置可以有多条审计日志
- 审计日志记录了配置的变更历史

**级联规则**：
- 删除配置时保留审计日志，用于历史追溯
- 审计日志不随配置删除而删除

**使用场景**：
```java
// 查询配置的所有审计日志
List<DataiConfigAuditLog> logs = auditLogService.selectByObjectIdAndObjectType(
    configId, "配置"
);

// 记录配置操作日志
DataiConfigAuditLog log = new DataiConfigAuditLog();
log.setObjectType("配置");
log.setObjectId(configId);
log.setOperationType("修改");
log.setOldValue(JSON.toJSONString(oldConfig));
log.setNewValue(JSON.toJSONString(newConfig));
```

### 6.4 DataiConfigAuditLog 与 DataiConfigVersion

**关系类型**：多对一（N:1）

**关联字段**：
- `DataiConfigAuditLog.objectId` → `DataiConfigVersion.id`（当 objectType = "版本" 时）

**业务含义**：
- 一条审计日志记录对一个版本的操作
- 一个版本可以有多条审计日志
- 审计日志记录了版本的发布、回滚等操作

**级联规则**：
- 删除版本时保留审计日志，用于历史追溯
- 审计日志不随版本删除而删除

**使用场景**：
```java
// 查询版本的所有审计日志
List<DataiConfigAuditLog> logs = auditLogService.selectByObjectIdAndObjectType(
    versionId, "版本"
);

// 记录版本操作日志
DataiConfigAuditLog log = new DataiConfigAuditLog();
log.setObjectType("版本");
log.setObjectId(versionId);
log.setOperationType("发布");
log.setOperationDesc("发布版本：" + versionNumber);
```

## 7. 多租户隔离

所有实体类都包含 `deptId` 字段，用于实现部门级别的多租户隔离。

**隔离规则**：
- 不同部门的配置、环境、版本、快照、审计日志相互独立
- 查询时必须带上 `deptId` 条件
- 跨部门数据访问需要特殊权限

**使用场景**：
```java
// 查询当前部门的配置
Long currentDeptId = SecurityUtils.getDeptId();
List<DataiConfiguration> configs = configurationService.selectByDeptId(currentDeptId);

// 创建配置时设置部门ID
DataiConfiguration config = new DataiConfiguration();
config.setDeptId(currentDeptId);
```

## 8. 数据一致性保证

### 8.1 配置与环境的一致性
- 配置的 `environmentId` 必须引用存在的环境
- 删除环境前需要检查是否有关联的配置

### 8.2 版本与快照的一致性
- 版本的 `snapshotId` 必须引用存在的快照
- 快照的 `versionId` 必须引用存在的版本
- 删除版本时级联删除快照

### 8.3 审计日志的完整性
- 审计日志记录了所有配置和版本的操作
- 审计日志不随配置或版本的删除而删除
- 审计日志提供完整的操作追溯能力

## 9. 性能优化建议

### 9.1 索引建议
- `DataiConfiguration.environmentId` - 加速按环境查询配置
- `DataiConfiguration.configKey` - 加速按配置键查询
- `DataiConfigAuditLog.objectId` 和 `objectType` - 加速审计日志查询
- `DataiConfigAuditLog.operationTime` - 加速按时间范围查询审计日志

### 9.2 缓存策略
- 配置数据缓存到 Redis，减少数据库查询
- 环境数据缓存到 Redis，加速环境切换
- 版本数据按需缓存，避免占用过多内存

### 9.3 查询优化
- 使用批量查询减少数据库访问次数
- 使用分页查询避免返回大量数据
- 使用索引加速查询

## 10. 总结

Salesforce配置管理模块的实体类关系设计遵循了以下原则：

1. **单一职责原则**：每个实体类负责一个特定的业务领域
2. **关联清晰**：实体之间的关联关系明确，易于理解和维护
3. **数据隔离**：通过 `deptId` 实现多租户隔离
4. **审计完整**：通过 `DataiConfigAuditLog` 记录所有操作
5. **版本控制**：通过 `DataiConfigVersion` 和 `DataiConfigSnapshot` 实现版本管理

这些实体类共同构成了一个完整的配置管理系统，支持配置的存储、版本控制、审计和多环境管理等功能。
