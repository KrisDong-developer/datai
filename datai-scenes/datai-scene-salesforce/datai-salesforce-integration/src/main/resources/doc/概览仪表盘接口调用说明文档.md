# 概览仪表盘接口调用说明文档

## 1. 文档概述

### 1.1 文档说明

本文档详细描述了概览仪表盘页面所需的所有 API 接口，包括接口地址、请求参数、响应数据格式、错误码说明等内容。

### 1.2 接口列表

| 序号 | 接口名称 | 接口地址 | 请求方法 | 说明 |
|-----|---------|---------|---------|------|
| 1 | 获取概览数据 | /dashboard/overview | GET | 获取核心指标卡片数据 |
| 2 | 获取 API 状态 | /dashboard/api-status | GET | 获取各 API 类型的限流状态 |
| 3 | 获取同步进度 | /dashboard/sync-progress | GET | 获取正在进行的同步任务进度 |
| 4 | 获取告警列表 | /dashboard/alerts | GET | 获取最近的告警信息 |
| 5 | 获取 API 调用趋势 | /dashboard/api-trends | GET | 获取 API 调用趋势数据 |

### 1.3 通用说明

#### 1.3.1 基础 URL

```
开发环境: http://localhost:8080/api
测试环境: http://test.example.com/api
生产环境: http://prod.example.com/api
```

#### 1.3.2 通用请求头

```http
Content-Type: application/json
Authorization: Bearer {access_token}
Accept: application/json
```

#### 1.3.3 通用响应格式

所有接口的响应格式如下：

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1735392000000
}
```

**字段说明**:
- `code`: 响应状态码
- `message`: 响应消息
- `data`: 响应数据
- `timestamp`: 响应时间戳（毫秒）

#### 1.3.4 通用错误码

| 错误码 | 错误信息 | 说明 |
|-------|---------|------|
| 200 | success | 请求成功 |
| 400 | Bad Request | 请求参数错误 |
| 401 | Unauthorized | 未授权，需要登录 |
| 403 | Forbidden | 无权限访问 |
| 404 | Not Found | 资源不存在 |
| 500 | Internal Server Error | 服务器内部错误 |
| 503 | Service Unavailable | 服务不可用 |

---

## 2. 获取概览数据

### 2.1 接口信息

**接口名称**: 获取概览数据

**接口地址**: `/dashboard/overview`

**请求方法**: `GET`

**接口描述**: 获取概览仪表盘的核心指标卡片数据，包括总对象数、启用同步对象数、今日同步批次、成功率、API 调用次数、限流告警数等指标。

### 2.2 请求参数

无请求参数。

### 2.3 请求示例

```http
GET /api/dashboard/overview HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Accept: application/json
```

### 2.4 响应数据

#### 2.4.1 成功响应

**状态码**: 200

**响应体**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalObjects": 128,
    "totalObjectsTrend": 5.2,
    "totalObjectsTrendType": "increase",
    "enabledSyncObjects": 45,
    "enabledSyncObjectsTrend": -2.0,
    "enabledSyncObjectsTrendType": "decrease",
    "todayBatches": 23,
    "todayBatchesTrend": 12.5,
    "todayBatchesTrendType": "increase",
    "successRate": 98.5,
    "successRateTrend": 0.3,
    "successRateTrendType": "increase",
    "apiCallCount": 12456,
    "apiCallCountTrend": 8.2,
    "apiCallCountTrendType": "increase",
    "rateLimitAlerts": 3,
    "rateLimitAlertsTrend": -1,
    "rateLimitAlertsTrendType": "decrease"
  },
  "timestamp": 1735392000000
}
```

#### 2.4.2 响应字段说明

| 字段名 | 类型 | 说明 | 示例值 |
|-------|------|------|-------|
| totalObjects | Integer | 总对象数 | 128 |
| totalObjectsTrend | Double | 总对象数趋势百分比 | 5.2 |
| totalObjectsTrendType | String | 总对象数趋势类型（increase/decrease/stable） | increase |
| enabledSyncObjects | Integer | 启用同步对象数 | 45 |
| enabledSyncObjectsTrend | Double | 启用同步对象数趋势百分比 | -2.0 |
| enabledSyncObjectsTrendType | String | 启用同步对象数趋势类型 | decrease |
| todayBatches | Integer | 今日同步批次 | 23 |
| todayBatchesTrend | Double | 今日同步批次趋势百分比 | 12.5 |
| todayBatchesTrendType | String | 今日同步批次趋势类型 | increase |
| successRate | Double | 成功率（百分比） | 98.5 |
| successRateTrend | Double | 成功率趋势百分比 | 0.3 |
| successRateTrendType | String | 成功率趋势类型 | increase |
| apiCallCount | Integer | API 调用次数 | 12456 |
| apiCallCountTrend | Double | API 调用次数趋势百分比 | 8.2 |
| apiCallCountTrendType | String | API 调用次数趋势类型 | increase |
| rateLimitAlerts | Integer | 限流告警数 | 3 |
| rateLimitAlertsTrend | Double | 限流告警数趋势 | -1 |
| rateLimitAlertsTrendType | String | 限流告警数趋势类型 | decrease |

#### 2.4.3 错误响应

**状态码**: 401

**响应体**:
```json
{
  "code": 401,
  "message": "Unauthorized",
  "data": null,
  "timestamp": 1735392000000
}
```

**状态码**: 500

**响应体**:
```json
{
  "code": 500,
  "message": "Internal Server Error",
  "data": null,
  "timestamp": 1735392000000
}
```

### 2.5 前端调用示例

#### 2.5.1 使用 Axios

```javascript
import axios from 'axios';

const getDashboardOverview = async () => {
  try {
    const response = await axios.get('/api/dashboard/overview', {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'application/json'
      }
    });
    return response.data;
  } catch (error) {
    console.error('获取概览数据失败:', error);
    throw error;
  }
};

export default getDashboardOverview;
```

#### 2.5.2 使用 Fetch

```javascript
const getDashboardOverview = async () => {
  try {
    const response = await fetch('/api/dashboard/overview', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    return await response.json();
  } catch (error) {
    console.error('获取概览数据失败:', error);
    throw error;
  }
};

export default getDashboardOverview;
```

### 2.6 数据处理示例

```javascript
const handleDashboardData = (data) => {
  const {
    totalObjects,
    totalObjectsTrend,
    totalObjectsTrendType,
    enabledSyncObjects,
    enabledSyncObjectsTrend,
    enabledSyncObjectsTrendType,
    todayBatches,
    todayBatchesTrend,
    todayBatchesTrendType,
    successRate,
    successRateTrend,
    successRateTrendType,
    apiCallCount,
    apiCallCountTrend,
    apiCallCountTrendType,
    rateLimitAlerts,
    rateLimitAlertsTrend,
    rateLimitAlertsTrendType
  } = data;
  
  return {
    totalObjects: {
      value: totalObjects,
      trend: totalObjectsTrend,
      trendType: totalObjectsTrendType,
      trendText: totalObjectsTrendType === 'increase' ? '↑' : 
                 totalObjectsTrendType === 'decrease' ? '↓' : '-',
      trendColor: totalObjectsTrendType === 'increase' ? '#52c41a' : 
                 totalObjectsTrendType === 'decrease' ? '#ff4d4f' : '#999'
    },
    enabledSyncObjects: {
      value: enabledSyncObjects,
      trend: enabledSyncObjectsTrend,
      trendType: enabledSyncObjectsTrendType,
      trendText: enabledSyncObjectsTrendType === 'increase' ? '↑' : 
                 enabledSyncObjectsTrendType === 'decrease' ? '↓' : '-',
      trendColor: enabledSyncObjectsTrendType === 'increase' ? '#52c41a' : 
                 enabledSyncObjectsTrendType === 'decrease' ? '#ff4d4f' : '#999'
    },
    todayBatches: {
      value: todayBatches,
      trend: todayBatchesTrend,
      trendType: todayBatchesTrendType,
      trendText: todayBatchesTrendType === 'increase' ? '↑' : 
                 todayBatchesTrendType === 'decrease' ? '↓' : '-',
      trendColor: todayBatchesTrendType === 'increase' ? '#52c41a' : 
                 todayBatchesTrendType === 'decrease' ? '#ff4d4f' : '#999'
    },
    successRate: {
      value: `${successRate}%`,
      trend: successRateTrend,
      trendType: successRateTrendType,
      trendText: successRateTrendType === 'increase' ? '↑' : 
                 successRateTrendType === 'decrease' ? '↓' : '-',
      trendColor: successRateTrendType === 'increase' ? '#52c41a' : 
                 successRateTrendType === 'decrease' ? '#ff4d4f' : '#999',
      statusColor: successRate >= 95 ? '#52c41a' : 
                  successRate >= 90 ? '#faad14' : '#ff4d4f'
    },
    apiCallCount: {
      value: apiCallCount.toLocaleString(),
      trend: apiCallCountTrend,
      trendType: apiCallCountTrendType,
      trendText: apiCallCountTrendType === 'increase' ? '↑' : 
                 apiCallCountTrendType === 'decrease' ? '↓' : '-',
      trendColor: apiCallCountTrendType === 'increase' ? '#52c41a' : 
                 apiCallCountTrendType === 'decrease' ? '#ff4d4f' : '#999'
    },
    rateLimitAlerts: {
      value: rateLimitAlerts,
      trend: rateLimitAlertsTrend,
      trendType: rateLimitAlertsTrendType,
      trendText: rateLimitAlertsTrendType === 'increase' ? '↑' : 
                 rateLimitAlertsTrendType === 'decrease' ? '↓' : '-',
      trendColor: rateLimitAlertsTrendType === 'increase' ? '#ff4d4f' : 
                 rateLimitAlertsTrendType === 'decrease' ? '#52c41a' : '#999',
      statusColor: rateLimitAlerts === 0 ? '#52c41a' : 
                  rateLimitAlerts <= 5 ? '#faad14' : '#ff4d4f'
    }
  };
};
```

---

## 3. 获取 API 状态

### 3.1 接口信息

**接口名称**: 获取 API 状态

**接口地址**: `/dashboard/api-status`

**请求方法**: `GET`

**接口描述**: 获取各 API 类型（Bulk API V1/V2、SOAP API、REST API）的限流状态，包括可用令牌数、今日已用、每日限额、使用率等信息。

### 3.2 请求参数

无请求参数。

### 3.3 请求示例

```http
GET /api/dashboard/api-status HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Accept: application/json
```

### 3.4 响应数据

#### 3.4.1 成功响应

**状态码**: 200

**响应体**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "apiStatusList": [
      {
        "apiType": "BULK_API_V1",
        "apiTypeName": "Bulk API V1",
        "availableTokens": 2,
        "dailyUsed": 2,
        "dailyLimit": 5,
        "usagePercentage": 40.0,
        "status": "normal"
      },
      {
        "apiType": "BULK_API_V2",
        "apiTypeName": "Bulk API V2",
        "availableTokens": 25,
        "dailyUsed": 75,
        "dailyLimit": 100,
        "usagePercentage": 75.0,
        "status": "warning"
      },
      {
        "apiType": "SOAP_API",
        "apiTypeName": "SOAP API",
        "availableTokens": 12000,
        "dailyUsed": 3000,
        "dailyLimit": 15000,
        "usagePercentage": 20.0,
        "status": "normal"
      },
      {
        "apiType": "REST_API",
        "apiTypeName": "REST API",
        "availableTokens": 2250,
        "dailyUsed": 12750,
        "dailyLimit": 15000,
        "usagePercentage": 85.0,
        "status": "critical"
      }
    ]
  },
  "timestamp": 1735392000000
}
```

#### 3.4.2 响应字段说明

**apiStatusList 数组字段说明**:

| 字段名 | 类型 | 说明 | 示例值 |
|-------|------|------|-------|
| apiType | String | API 类型代码 | BULK_API_V1 |
| apiTypeName | String | API 类型名称 | Bulk API V1 |
| availableTokens | Integer | 可用令牌数 | 2 |
| dailyUsed | Integer | 今日已用配额 | 2 |
| dailyLimit | Integer | 每日限额 | 5 |
| usagePercentage | Double | 使用率百分比 | 40.0 |
| status | String | 状态（normal/warning/critical） | normal |

**API 类型说明**:

| API 类型代码 | API 类型名称 | 说明 |
|-------------|-------------|------|
| BULK_API_V1 | Bulk API V1 | Salesforce Bulk API V1 |
| BULK_API_V2 | Bulk API V2 | Salesforce Bulk API V2 |
| SOAP_API | SOAP API | Salesforce SOAP API |
| REST_API | REST API | Salesforce REST API |

**状态说明**:

| 状态代码 | 状态名称 | 说明 | 颜色 |
|---------|---------|------|------|
| normal | 正常 | 使用率 < 50% | 绿色 |
| warning | 警告 | 使用率 50%-80% | 黄色 |
| critical | 严重 | 使用率 > 80% | 红色 |

#### 3.4.3 错误响应

**状态码**: 401

**响应体**:
```json
{
  "code": 401,
  "message": "Unauthorized",
  "data": null,
  "timestamp": 1735392000000
}
```

**状态码**: 500

**响应体**:
```json
{
  "code": 500,
  "message": "Internal Server Error",
  "data": null,
  "timestamp": 1735392000000
}
```

### 3.5 前端调用示例

#### 3.5.1 使用 Axios

```javascript
import axios from 'axios';

const getApiStatus = async () => {
  try {
    const response = await axios.get('/api/dashboard/api-status', {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'application/json'
      }
    });
    return response.data;
  } catch (error) {
    console.error('获取 API 状态失败:', error);
    throw error;
  }
};

export default getApiStatus;
```

#### 3.5.2 使用 Fetch

```javascript
const getApiStatus = async () => {
  try {
    const response = await fetch('/api/dashboard/api-status', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    return await response.json();
  } catch (error) {
    console.error('获取 API 状态失败:', error);
    throw error;
  }
};

export default getApiStatus;
```

### 3.6 数据处理示例

```javascript
const handleApiStatusData = (data) => {
  const { apiStatusList } = data;
  
  return apiStatusList.map(api => {
    const progressColor = api.usagePercentage < 50 ? '#52c41a' : 
                        api.usagePercentage < 80 ? '#faad14' : '#ff4d4f';
    
    return {
      ...api,
      progressColor,
      statusColor: api.status === 'normal' ? '#52c41a' : 
                  api.status === 'warning' ? '#faad14' : '#ff4d4f',
      statusText: api.status === 'normal' ? '正常' : 
                 api.status === 'warning' ? '警告' : '严重'
    };
  });
};
```

---

## 4. 获取同步进度

### 4.1 接口信息

**接口名称**: 获取同步进度

**接口地址**: `/dashboard/sync-progress`

**请求方法**: `GET`

**接口描述**: 获取当前正在进行的同步任务进度，包括对象名称、同步类型、进度百分比、已处理记录数、总记录数、预计剩余时间等信息。

### 4.2 请求参数

无请求参数。

### 4.3 请求示例

```http
GET /api/dashboard/sync-progress HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Accept: application/json
```

### 4.4 响应数据

#### 4.4.1 成功响应

**状态码**: 200

**响应体**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "syncProgressList": [
      {
        "batchId": "123456",
        "objectApiName": "Account",
        "objectLabel": "客户",
        "syncType": "full",
        "syncTypeName": "全量同步",
        "progress": 80.0,
        "processedRecords": 8000,
        "totalRecords": 10000,
        "estimatedRemainingTime": 300,
        "estimatedRemainingTimeText": "5分钟",
        "status": "running"
      },
      {
        "batchId": "123457",
        "objectApiName": "Contact",
        "objectLabel": "联系人",
        "syncTypeName": "增量同步",
        "syncType": "incremental",
        "syncTypeName": "增量同步",
        "progress": 40.0,
        "processedRecords": 4000,
        "totalRecords": 10000,
        "estimatedRemainingTime": 480,
        "estimatedRemainingTimeText": "8分钟",
        "status": "running"
      },
      {
        "batchId": "123458",
        "objectApiName": "Opportunity",
        "objectLabel": "商机",
        "syncType": "full",
        "syncTypeName": "全量同步",
        "progress": 20.0,
        "processedRecords": 2000,
        "totalRecords": 10000,
        "estimatedRemainingTime": 720,
        "estimatedRemainingTimeText": "12分钟",
        "status": "running"
      }
    ]
  },
  "timestamp": 1735392000000
}
```

#### 4.4.2 响应字段说明

**syncProgressList 数组字段说明**:

| 字段名 | 类型 | 说明 | 示例值 |
|-------|------|------|-------|
| batchId | String | 批次 ID | 123456 |
| objectApiName | String | 对象 API 名称 | Account |
| objectLabel | String | 对象标签 | 客户 |
| syncType | String | 同步类型代码 | full |
| syncTypeName | String | 同步类型名称 | 全量同步 |
| progress | Double | 进度百分比 | 80.0 |
| processedRecords | Integer | 已处理记录数 | 8000 |
| totalRecords | Integer | 总记录数 | 10000 |
| estimatedRemainingTime | Integer | 预计剩余时间（秒） | 300 |
| estimatedRemainingTimeText | String | 预计剩余时间文本 | 5分钟 |
| status | String | 状态（running/paused/stopped/completed） | running |

**同步类型说明**:

| 同步类型代码 | 同步类型名称 | 说明 |
|-------------|-------------|------|
| full | 全量同步 | 全量同步数据 |
| incremental | 增量同步 | 增量同步数据 |

**状态说明**:

| 状态代码 | 状态名称 | 说明 |
|---------|---------|------|
| running | 运行中 | 同步任务正在运行 |
| paused | 已暂停 | 同步任务已暂停 |
| stopped | 已停止 | 同步任务已停止 |
| completed | 已完成 | 同步任务已完成 |

#### 4.4.3 空数据响应

**状态码**: 200

**响应体**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "syncProgressList": []
  },
  "timestamp": 1735392000000
}
```

#### 4.4.4 错误响应

**状态码**: 401

**响应体**:
```json
{
  "code": 401,
  "message": "Unauthorized",
  "data": null,
  "timestamp": 1735392000000
}
```

**状态码**: 500

**响应体**:
```json
{
  "code": 500,
  "message": "Internal Server Error",
  "data": null,
  "timestamp": 1735392000000
}
```

### 4.5 前端调用示例

#### 4.5.1 使用 Axios

```javascript
import axios from 'axios';

const getSyncProgress = async () => {
  try {
    const response = await axios.get('/api/dashboard/sync-progress', {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'application/json'
      }
    });
    return response.data;
  } catch (error) {
    console.error('获取同步进度失败:', error);
    throw error;
  }
};

export default getSyncProgress;
```

#### 4.5.2 使用 Fetch

```javascript
const getSyncProgress = async () => {
  try {
    const response = await fetch('/api/dashboard/sync-progress', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    return await response.json();
  } catch (error) {
    console.error('获取同步进度失败:', error);
    throw error;
  }
};

export default getSyncProgress;
```

### 4.6 数据处理示例

```javascript
const handleSyncProgressData = (data) => {
  const { syncProgressList } = data;
  
  if (syncProgressList.length === 0) {
    return {
      isEmpty: true,
      list: []
    };
  }
  
  return {
    isEmpty: false,
    list: syncProgressList.map(task => ({
      ...task,
      statusText: task.status === 'running' ? '运行中' : 
                 task.status === 'paused' ? '已暂停' : 
                 task.status === 'stopped' ? '已停止' : '已完成',
      statusColor: task.status === 'running' ? '#52c41a' : 
                  task.status === 'paused' ? '#faad14' : 
                  task.status === 'stopped' ? '#ff4d4f' : '#999'
    }))
  };
};
```

---

## 5. 获取告警列表

### 5.1 接口信息

**接口名称**: 获取告警列表

**接口地址**: `/dashboard/alerts`

**请求方法**: `GET`

**接口描述**: 获取最近的告警信息，包括告警级别、告警类型、告警内容、告警时间、处理状态等。

### 5.2 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|-------|------|------|------|-------|
| limit | Integer | 否 | 返回数量，默认 10，最大 100 | 10 |

### 5.3 请求示例

```http
GET /api/dashboard/alerts?limit=10 HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Accept: application/json
```

### 5.4 响应数据

#### 5.4.1 成功响应

**状态码**: 200

**响应体**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "alertList": [
      {
        "alertId": "123456",
        "alertLevel": "critical",
        "alertLevelName": "严重",
        "alertType": "rate_limit",
        "alertTypeName": "限流告警",
        "alertTitle": "REST API 限流告警",
        "alertContent": "REST API 使用率已达到 85%，接近限流阈值",
        "alertTime": "2025-12-28T14:30:25",
        "alertTimeText": "2025-12-28 14:30:25",
        "handleStatus": "unhandled",
        "handleStatusName": "未处理"
      },
      {
        "alertId": "123457",
        "alertLevel": "warning",
        "alertLevelName": "警告",
        "alertType": "sync_failure",
        "alertTypeName": "同步失败",
        "alertTitle": "Account 同步失败",
        "alertContent": "Account 对象同步失败，错误码: INVALID_OPERATION",
        "alertTime": "2025-12-28T14:25:10",
        "alertTimeText": "2025-12-28 14:25:10",
        "handleStatus": "unhandled",
        "handleStatusName": "未处理"
      },
      {
        "alertId": "123458",
        "alertLevel": "info",
        "alertLevelName": "信息",
        "alertType": "sync_complete",
        "alertTypeName": "同步完成",
        "alertTitle": "Contact 同步完成",
        "alertContent": "Contact 对象同步完成，共处理 5,000 条记录",
        "alertTime": "2025-12-28T14:20:00",
        "alertTimeText": "2025-12-28 14:20:00",
        "handleStatus": "handled",
        "handleStatusName": "已处理"
      },
      {
        "alertId": "123459",
        "alertLevel": "critical",
        "alertLevelName": "严重",
        "alertType": "connection_error",
        "alertTypeName": "连接异常",
        "alertTitle": "Salesforce 连接异常",
        "alertContent": "无法连接到 Salesforce，请检查网络连接",
        "alertTime": "2025-12-28T14:15:30",
        "alertTimeText": "2025-12-28 14:15:30",
        "handleStatus": "handling",
        "handleStatusName": "处理中"
      }
    ],
    "total": 4
  },
  "timestamp": 1735392000000
}
```

#### 5.4.2 响应字段说明

**alertList 数组字段说明**:

| 字段名 | 类型 | 说明 | 示例值 |
|-------|------|------|-------|
| alertId | String | 告警 ID | 123456 |
| alertLevel | String | 告警级别代码 | critical |
| alertLevelName | String | 告警级别名称 | 严重 |
| alertType | String | 告警类型代码 | rate_limit |
| alertTypeName | String | 告警类型名称 | 限流告警 |
| alertTitle | String | 告警标题 | REST API 限流告警 |
| alertContent | String | 告警内容 | REST API 使用率已达到 85%，接近限流阈值 |
| alertTime | String | 告警时间（ISO 8601） | 2025-12-28T14:30:25 |
| alertTimeText | String | 告警时间文本 | 2025-12-28 14:30:25 |
| handleStatus | String | 处理状态代码 | unhandled |
| handleStatusName | String | 处理状态名称 | 未处理 |

**告警级别说明**:

| 告警级别代码 | 告警级别名称 | 说明 | 颜色 |
|-------------|-------------|------|------|
| critical | 严重 | 严重告警 | 红色 |
| warning | 警告 | 警告告警 | 黄色 |
| info | 信息 | 信息告警 | 蓝色 |

**告警类型说明**:

| 告警类型代码 | 告警类型名称 | 说明 |
|-------------|-------------|------|
| rate_limit | 限流告警 | API 限流告警 |
| sync_failure | 同步失败 | 同步失败告警 |
| sync_complete | 同步完成 | 同步完成通知 |
| connection_error | 连接异常 | 连接异常告警 |
| quota_exceeded | 配额超限 | 配额超限告警 |

**处理状态说明**:

| 处理状态代码 | 处理状态名称 | 说明 | 颜色 |
|-------------|-------------|------|------|
| unhandled | 未处理 | 未处理 | 红色 |
| handling | 处理中 | 处理中 | 黄色 |
| handled | 已处理 | 已处理 | 绿色 |

#### 5.4.3 空数据响应

**状态码**: 200

**响应体**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "alertList": [],
    "total": 0
  },
  "timestamp": 1735392000000
}
```

#### 5.4.4 错误响应

**状态码**: 400

**响应体**:
```json
{
  "code": 400,
  "message": "Bad Request: limit parameter must be between 1 and 100",
  "data": null,
  "timestamp": 1735392000000
}
```

**状态码**: 401

**响应体**:
```json
{
  "code": 401,
  "message": "Unauthorized",
  "data": null,
  "timestamp": 1735392000000
}
```

**状态码**: 500

**响应体**:
```json
{
  "code": 500,
  "message": "Internal Server Error",
  "data": null,
  "timestamp": 1735392000000
}
```

### 5.5 前端调用示例

#### 5.5.1 使用 Axios

```javascript
import axios from 'axios';

const getAlertList = async (limit = 10) => {
  try {
    const response = await axios.get('/api/dashboard/alerts', {
      params: { limit },
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'application/json'
      }
    });
    return response.data;
  } catch (error) {
    console.error('获取告警列表失败:', error);
    throw error;
  }
};

export default getAlertList;
```

#### 5.5.2 使用 Fetch

```javascript
const getAlertList = async (limit = 10) => {
  try {
    const url = new URL('/api/dashboard/alerts', window.location.origin);
    url.searchParams.append('limit', limit);
    
    const response = await fetch(url.toString(), {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    return await response.json();
  } catch (error) {
    console.error('获取告警列表失败:', error);
    throw error;
  }
};

export default getAlertList;
```

### 5.6 数据处理示例

```javascript
const handleAlertListData = (data) => {
  const { alertList, total } = data;
  
  return {
    list: alertList.map(alert => ({
      ...alert,
      levelColor: alert.alertLevel === 'critical' ? '#ff4d4f' : 
                 alert.alertLevel === 'warning' ? '#faad14' : '#1890ff',
      levelBgColor: alert.alertLevel === 'critical' ? '#ff4d4f' : 
                   alert.alertLevel === 'warning' ? '#faad14' : '#1890ff',
      statusColor: alert.handleStatus === 'unhandled' ? '#ff4d4f' : 
                  alert.handleStatus === 'handling' ? '#faad14' : '#52c41a',
      borderColor: alert.alertLevel === 'critical' ? '#ff4d4f' : 
                  alert.alertLevel === 'warning' ? '#faad14' : '#1890ff'
    })),
    total
  };
};
```

---

## 6. 获取 API 调用趋势

### 6.1 接口信息

**接口名称**: 获取 API 调用趋势

**接口地址**: `/dashboard/api-trends`

**请求方法**: `GET`

**接口描述**: 获取 API 调用趋势数据，包括总调用次数、成功次数、失败次数的时间序列数据，支持不同时间维度的查询。

### 6.2 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|-------|------|------|------|-------|
| timeDimension | String | 否 | 时间维度（today/week/month/custom），默认 today | today |
| startDate | String | 否 | 自定义开始日期（timeDimension=custom 时必填），格式：yyyy-MM-dd | 2025-12-01 |
| endDate | String | 否 | 自定义结束日期（timeDimension=custom 时必填），格式：yyyy-MM-dd | 2025-12-28 |

### 6.3 请求示例

#### 6.3.1 查询今天的数据

```http
GET /api/dashboard/api-trends?timeDimension=today HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Accept: application/json
```

#### 6.3.2 查询本周的数据

```http
GET /api/dashboard/api-trends?timeDimension=week HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Accept: application/json
```

#### 6.3.3 查询自定义时间范围的数据

```http
GET /api/dashboard/api-trends?timeDimension=custom&startDate=2025-12-01&endDate=2025-12-28 HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Accept: application/json
```

### 6.4 响应数据

#### 6.4.1 成功响应（今天）

**状态码**: 200

**响应体**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "timeDimension": "today",
    "timeDimensionName": "今天",
    "labels": ["00:00", "04:00", "08:00", "12:00", "16:00", "20:00"],
    "totalCalls": [1200, 1800, 2500, 3200, 2800, 956],
    "successCalls": [1180, 1760, 2450, 3150, 2750, 910],
    "failedCalls": [20, 40, 50, 50, 50, 46],
    "totalCallsSum": 12456,
    "successCallsSum": 12300,
    "failedCallsSum": 156,
    "successRate": 98.7,
    "avgResponseTime": 245
  },
  "timestamp": 1735392000000
}
```

#### 6.4.2 成功响应（本周）

**状态码**: 200

**响应体**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "timeDimension": "week",
    "timeDimensionName": "本周",
    "labels": ["周一", "周二", "周三", "周四", "周五", "周六", "周日"],
    "totalCalls": [12000, 15000, 18000, 16500, 14000, 8000, 7500],
    "successCalls": [11800, 14800, 17700, 16200, 13700, 7850, 7350],
    "failedCalls": [200, 200, 300, 300, 300, 150, 150],
    "totalCallsSum": 91000,
    "successCallsSum": 89400,
    "failedCallsSum": 1600,
    "successRate": 98.2,
    "avgResponseTime": 238
  },
  "timestamp": 1735392000000
}
```

#### 6.4.3 成功响应（本月）

**状态码**: 200

**响应体**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "timeDimension": "month",
    "timeDimensionName": "本月",
    "labels": ["1日", "5日", "10日", "15日", "20日", "25日", "28日"],
    "totalCalls": [45000, 52000, 48000, 55000, 51000, 49000, 47000],
    "successCalls": [44200, 51000, 47100, 53900, 50000, 48000, 46100],
    "failedCalls": [800, 1000, 900, 1100, 1000, 1000, 900],
    "totalCallsSum": 347000,
    "successCallsSum": 340300,
    "failedCallsSum": 6700,
    "successRate": 98.1,
    "avgResponseTime": 242
  },
  "timestamp": 1735392000000
}
```

#### 6.4.4 响应字段说明

| 字段名 | 类型 | 说明 | 示例值 |
|-------|------|------|-------|
| timeDimension | String | 时间维度代码 | today |
| timeDimensionName | String | 时间维度名称 | 今天 |
| labels | Array<String> | 时间标签数组 | ["00:00", "04:00", "08:00", "12:00", "16:00", "20:00"] |
| totalCalls | Array<Integer> | 总调用次数数组 | [1200, 1800, 2500, 3200, 2800, 956] |
| successCalls | Array<Integer> | 成功调用次数数组 | [1180, 1760, 2450, 3150, 2750, 910] |
| failedCalls | Array<Integer> | 失败调用次数数组 | [20, 40, 50, 50, 50, 46] |
| totalCallsSum | Integer | 总调用次数总和 | 12456 |
| successCallsSum | Integer | 成功调用次数总和 | 12300 |
| failedCallsSum | Integer | 失败调用次数总和 | 156 |
| successRate | Double | 成功率（百分比） | 98.7 |
| avgResponseTime | Integer | 平均响应时间（毫秒） | 245 |

**时间维度说明**:

| 时间维度代码 | 时间维度名称 | 说明 | labels 示例 |
|-------------|-------------|------|-----------|
| today | 今天 | 今天的数据，按小时分组 | ["00:00", "04:00", "08:00", "12:00", "16:00", "20:00"] |
| week | 本周 | 本周的数据，按天分组 | ["周一", "周二", "周三", "周四", "周五", "周六", "周日"] |
| month | 本月 | 本月的数据，按日期分组 | ["1日", "5日", "10日", "15日", "20日", "25日", "28日"] |
| custom | 自定义 | 自定义时间范围，按天分组 | ["2025-12-01", "2025-12-05", "2025-12-10", ...] |

#### 6.4.5 错误响应

**状态码**: 400

**响应体**:
```json
{
  "code": 400,
  "message": "Bad Request: timeDimension must be one of [today, week, month, custom]",
  "data": null,
  "timestamp": 1735392000000
}
```

**状态码**: 400（自定义时间范围缺少参数）

**响应体**:
```json
{
  "code": 400,
  "message": "Bad Request: startDate and endDate are required when timeDimension is custom",
  "data": null,
  "timestamp": 1735392000000
}
```

**状态码**: 400（日期格式错误）

**响应体**:
```json
{
  "code": 400,
  "message": "Bad Request: Invalid date format, expected yyyy-MM-dd",
  "data": null,
  "timestamp": 1735392000000
}
```

**状态码**: 401

**响应体**:
```json
{
  "code": 401,
  "message": "Unauthorized",
  "data": null,
  "timestamp": 1735392000000
}
```

**状态码**: 500

**响应体**:
```json
{
  "code": 500,
  "message": "Internal Server Error",
  "data": null,
  "timestamp": 1735392000000
}
```

### 6.5 前端调用示例

#### 6.5.1 使用 Axios

```javascript
import axios from 'axios';

const getApiTrends = async (timeDimension = 'today', startDate = null, endDate = null) => {
  try {
    const params = { timeDimension };
    
    if (timeDimension === 'custom' && startDate && endDate) {
      params.startDate = startDate;
      params.endDate = endDate;
    }
    
    const response = await axios.get('/api/dashboard/api-trends', {
      params,
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'application/json'
      }
    });
    return response.data;
  } catch (error) {
    console.error('获取 API 调用趋势失败:', error);
    throw error;
  }
};

export default getApiTrends;
```

#### 6.5.2 使用 Fetch

```javascript
const getApiTrends = async (timeDimension = 'today', startDate = null, endDate = null) => {
  try {
    const url = new URL('/api/dashboard/api-trends', window.location.origin);
    url.searchParams.append('timeDimension', timeDimension);
    
    if (timeDimension === 'custom' && startDate && endDate) {
      url.searchParams.append('startDate', startDate);
      url.searchParams.append('endDate', endDate);
    }
    
    const response = await fetch(url.toString(), {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    return await response.json();
  } catch (error) {
    console.error('获取 API 调用趋势失败:', error);
    throw error;
  }
};

export default getApiTrends;
```

### 6.6 数据处理示例

```javascript
const handleApiTrendsData = (data) => {
  const {
    timeDimension,
    timeDimensionName,
    labels,
    totalCalls,
    successCalls,
    failedCalls,
    totalCallsSum,
    successCallsSum,
    failedCallsSum,
    successRate,
    avgResponseTime
  } = data;
  
  return {
    timeDimension,
    timeDimensionName,
    chartData: {
      labels,
      datasets: [
        {
          label: '总调用次数',
          data: totalCalls,
          borderColor: '#1890ff',
          backgroundColor: 'rgba(24, 144, 255, 0.1)',
          fill: true,
          tension: 0.4
        },
        {
          label: '成功次数',
          data: successCalls,
          borderColor: '#52c41a',
          backgroundColor: 'rgba(82, 196, 26, 0.1)',
          fill: true,
          tension: 0.4
        },
        {
          label: '失败次数',
          data: failedCalls,
          borderColor: '#ff4d4f',
          backgroundColor: 'rgba(255, 77, 79, 0.1)',
          fill: true,
          tension: 0.4
        }
      ]
    },
    stats: {
      totalCalls: totalCallsSum.toLocaleString(),
      successCalls: successCallsSum.toLocaleString(),
      failedCalls: failedCallsSum.toLocaleString(),
      successRate: `${successRate}%`,
      avgResponseTime: `${avgResponseTime}ms`
    }
  };
};
```

---

## 7. 接口调用最佳实践

### 7.1 错误处理

#### 7.1.1 统一错误处理

```javascript
import axios from 'axios';

const apiClient = axios.create({
  baseURL: '/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

apiClient.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

apiClient.interceptors.response.use(
  (response) => {
    return response.data;
  },
  (error) => {
    if (error.response) {
      const { status, data } = error.response;
      
      switch (status) {
        case 401:
          console.error('未授权，请重新登录');
          localStorage.removeItem('token');
          window.location.href = '/login';
          break;
        case 403:
          console.error('无权限访问');
          break;
        case 404:
          console.error('资源不存在');
          break;
        case 500:
          console.error('服务器内部错误');
          break;
        default:
          console.error(data.message || '请求失败');
      }
    } else if (error.request) {
      console.error('网络错误，请检查网络连接');
    } else {
      console.error('请求配置错误');
    }
    
    return Promise.reject(error);
  }
);

export default apiClient;
```

#### 7.1.2 使用示例

```javascript
import apiClient from './apiClient';

const getDashboardOverview = async () => {
  try {
    const response = await apiClient.get('/dashboard/overview');
    return response;
  } catch (error) {
    console.error('获取概览数据失败:', error);
    throw error;
  }
};
```

### 7.2 请求取消

```javascript
import axios from 'axios';

const createCancelableRequest = (config) => {
  const source = axios.CancelToken.source();
  
  const promise = axios({
    ...config,
    cancelToken: source.token
  });
  
  promise.cancel = () => {
    source.cancel('Request canceled');
  };
  
  return promise;
};

export default createCancelableRequest;
```

### 7.3 请求重试

```javascript
import axios from 'axios';

const retryRequest = async (fn, retries = 3, delay = 1000) => {
  try {
    return await fn();
  } catch (error) {
    if (retries <= 0) {
      throw error;
    }
    
    await new Promise(resolve => setTimeout(resolve, delay));
    return retryRequest(fn, retries - 1, delay);
  }
};

export default retryRequest;
```

### 7.4 请求缓存

```javascript
const cache = new Map();

const cachedRequest = async (key, fn, ttl = 30000) => {
  const cached = cache.get(key);
  
  if (cached && Date.now() - cached.timestamp < ttl) {
    return cached.data;
  }
  
  const data = await fn();
  cache.set(key, {
    data,
    timestamp: Date.now()
  });
  
  return data;
};

export default cachedRequest;
```

### 7.5 并发请求

```javascript
import axios from 'axios';

const fetchDashboardData = async () => {
  try {
    const [overview, apiStatus, syncProgress, alerts, trends] = await Promise.all([
      axios.get('/api/dashboard/overview'),
      axios.get('/api/dashboard/api-status'),
      axios.get('/api/dashboard/sync-progress'),
      axios.get('/api/dashboard/alerts'),
      axios.get('/api/dashboard/api-trends')
    ]);
    
    return {
      overview: overview.data,
      apiStatus: apiStatus.data,
      syncProgress: syncProgress.data,
      alerts: alerts.data,
      trends: trends.data
    };
  } catch (error) {
    console.error('获取仪表盘数据失败:', error);
    throw error;
  }
};

export default fetchDashboardData;
```

---

## 8. 接口测试

### 8.1 使用 Postman 测试

#### 8.1.1 导入接口集合

创建 Postman 集合，包含以下接口：
1. GET /dashboard/overview
2. GET /dashboard/api-status
3. GET /dashboard/sync-progress
4. GET /dashboard/alerts
5. GET /dashboard/api-trends

#### 8.1.2 设置环境变量

```json
{
  "base_url": "http://localhost:8080/api",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

#### 8.1.3 设置 Pre-request Script

```javascript
pm.request.headers.add({
  key: 'Authorization',
  value: `Bearer ${pm.environment.get('token')}`
});
```

### 8.2 使用 cURL 测试

#### 8.2.1 获取概览数据

```bash
curl -X GET "http://localhost:8080/api/dashboard/overview" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Accept: application/json"
```

#### 8.2.2 获取 API 状态

```bash
curl -X GET "http://localhost:8080/api/dashboard/api-status" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Accept: application/json"
```

#### 8.2.3 获取同步进度

```bash
curl -X GET "http://localhost:8080/api/dashboard/sync-progress" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Accept: application/json"
```

#### 8.2.4 获取告警列表

```bash
curl -X GET "http://localhost:8080/api/dashboard/alerts?limit=10" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Accept: application/json"
```

#### 8.2.5 获取 API 调用趋势

```bash
curl -X GET "http://localhost:8080/api/dashboard/api-trends?timeDimension=today" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Accept: application/json"
```

---

## 9. 附录

### 9.1 相关文档

- [概览仪表盘页面详细设计方案.md](file:///d:\idea_demo\datai\datai-scenes\datai-scene-salesforce\datai-salesforce-integration\src\main\resources\doc\概览仪表盘页面详细设计方案.md)
- [数据中心页面设计文档.md](file:///d:\idea_demo\datai\datai-scenes\datai-scene-salesforce\datai-salesforce-integration\src\main\resources\doc\数据中心页面设计文档.md)
- [模块说明文档.md](file:///d:\idea_demo\datai\datai-scenes\datai-scene-salesforce\datai-salesforce-integration\src\main\resources\doc\模块说明文档.md)
- [API Controller 方法清单文档.md](file:///d:\idea_demo\datai\datai-scenes\datai-scene-salesforce\datai-salesforce-integration\src\main\resources\doc\API Controller 方法清单文档.md)

### 9.2 更新记录

| 版本 | 日期 | 更新内容 | 作者 |
|-----|------|---------|------|
| 1.0 | 2025-12-28 | 初始版本，完成所有接口文档 | System |

---

**文档结束**
